(function(g){var window=this;'use strict';var I3T=function(r){var D=new g.mm("und",new g.sT("Default","und",!0));D.captionTracks=r.captionTracks;return D},xyR=function(r){return new g.gS(function(D,Y){var V=r.length,L=[];
if(V)for(var T=function(G,M){V--;L[G]=M;V==0&&D(L)},I=function(G){Y(G)},B,m=0;m<r.length;m++)B=r[m],g.HVf(B,g.rT(T,m),I);
else D(L)})},Ry=function(r){this.W=r},zd=function(){Ry.apply(this,arguments)},B$q=function(){zd.apply(this,arguments)},myr=function(){zd.apply(this,arguments)},GcR=function(){zd.apply(this,arguments)},MjS=function(){zd.apply(this,arguments)},jjq=function(){zd.apply(this,arguments)},QjS=function(){zd.apply(this,arguments)},sjS=function(){Ry.apply(this,arguments)},yWr=function(){zd.apply(this,arguments)},a3_=function(){zd.apply(this,arguments)},WZr=function(){zd.apply(this,arguments)},Uya=function(){zd.apply(this,
arguments)},FZ0=function(){zd.apply(this,arguments)},uKe=function(){zd.apply(this,arguments)},qxM=function(){zd.apply(this,arguments)},kcM=function(){zd.apply(this,arguments)},gfS=function(){zd.apply(this,arguments)},$yS=function(){zd.apply(this,arguments)},AWM=function(){zd.apply(this,arguments)},Omc=function(){zd.apply(this,arguments)},pFe=function(){Ry.apply(this,arguments)},hFW=function(){zd.apply(this,arguments)},tj5=function(){zd.apply(this,arguments)},imT=function(){zd.apply(this,arguments)},
JWx=function(){zd.apply(this,arguments)},KZ_=function(){zd.apply(this,arguments)},l3c=function(){zd.apply(this,arguments)},Ef_=function(){zd.apply(this,arguments)},RFr=function(){zd.apply(this,arguments)},zFe=function(){zd.apply(this,arguments)},dyx=function(){Ry.apply(this,arguments)},Sxx=function(){Ry.apply(this,arguments)},N$_=function(){Ry.apply(this,arguments)},vfr=function(){zd.apply(this,arguments)},bmM=function(){zd.apply(this,arguments)},eF5=function(){zd.apply(this,arguments)},cWW=function(){zd.apply(this,
arguments)},Cbr=function(){zd.apply(this,arguments)},ZmM=function(){zd.apply(this,arguments)},XFr=function(){zd.apply(this,arguments)},ofS=function(){zd.apply(this,arguments)},Pb5=function(){zd.apply(this,arguments)},nfq=function(){zd.apply(this,arguments)},HmS=function(){zd.apply(this,arguments)},f3_=function(){zd.apply(this,arguments)},wFS=function(){zd.apply(this,arguments)},rQ5=function(){zd.apply(this,arguments)},DQr=function(){zd.apply(this,arguments)},YGc=function(){zd.apply(this,arguments)},
VNS=function(){zd.apply(this,arguments)},LqR=function(){zd.apply(this,arguments)},T7a=function(){zd.apply(this,arguments)},I4S=function(){zd.apply(this,arguments)},xQ_=function(){zd.apply(this,arguments)},B7a=function(){zd.apply(this,arguments)},mQS=function(){zd.apply(this,arguments)},GWa=function(){zd.apply(this,arguments)},MNx=function(){zd.apply(this,arguments)},jFr=function(){zd.apply(this,arguments)},QF_=function(){Ry.apply(this,arguments)},sFr=function(){zd.apply(this,arguments)},yQ0=function(){zd.apply(this,
arguments)},a4W=function(){zd.apply(this,arguments)},Wqq=function(){zd.apply(this,arguments)},UQx=function(){zd.apply(this,arguments)},Fqr=function(){zd.apply(this,arguments)},uVT=function(){zd.apply(this,arguments)},qG5=function(){zd.apply(this,arguments)},kW0=function(){zd.apply(this,arguments)},gF0=function(){zd.apply(this,arguments)},$Qq=function(){zd.apply(this,arguments)},AQe=function(){zd.apply(this,arguments)},OQR=function(){zd.apply(this,arguments)},p4e=function(){zd.apply(this,arguments)},
h1q=function(){zd.apply(this,arguments)},tNW=function(){zd.apply(this,arguments)},iQc=function(){zd.apply(this,arguments)},JQ0=function(){zd.apply(this,arguments)},KqT=function(){zd.apply(this,arguments)},l4W=function(){zd.apply(this,arguments)},EFa=function(){zd.apply(this,arguments)},R1S=function(){zd.apply(this,arguments)},z1r=function(){zd.apply(this,arguments)},dQS=function(){zd.apply(this,arguments)},SG0=function(){zd.apply(this,arguments)},N7S=function(){zd.apply(this,arguments)},vFr=function(){zd.apply(this,
arguments)},bQx=function(){zd.apply(this,arguments)},e1R=function(){zd.apply(this,arguments)},cQM=function(){zd.apply(this,arguments)},C1S=function(){zd.apply(this,arguments)},ZQr=function(r){r=r.key||r.id;
if(!r)throw Error("Entity key is missing");return r},X4S=function(){if(da)return da();
var r={};da=g.GI("PersistentEntityStoreDb",{V0:(r.EntityStore={Dt:1},r.EntityAssociationStore={Dt:2},r),shared:!1,upgrade:function(D,Y){Y(1)&&g.ZG(g.NK(D,"EntityStore",{keyPath:"key"}),"entityType","entityType");Y(2)&&(D=g.NK(D,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.ZG(D,"byParentEntityKey","parentEntityKey"),g.ZG(D,"byChildEntityKey","childEntityKey"))},
version:3});return da()},oFS=function(r){return g.ri(X4S(),r)},P1q=function(r){return g.ri((0,g.NAc)(),r)},SY=function(r){this.token=r},Nv=function(r,D){D=D===void 0?{}:D;
g.Vw.call(this,g.vXW[r],Object.assign({},{name:"PESEncoderError",type:r},D));this.type=r;this.level="WARNING";Object.setPrototypeOf(this,Nv.prototype)},nFS=function(r){return new Nv("WRONG_DATA_TYPE",{t1:r})},HQ_=function(r){return r instanceof Error?new Nv("UNKNOWN_ENCODE_ERROR",{s_:r.message}):new Nv("UNKNOWN_ENCODE_ERROR")},f4c=function(r){return r instanceof Error?new Nv("UNKNOWN_DECODE_ERROR",{s_:r.message}):new Nv("UNKNOWN_DECODE_ERROR")},w4T=function(r,D){r=r instanceof Nv?r:D(r);
g.c1(r);throw r;},r1T=function(){},D9_=function(r,D,Y){try{return r.L(D,Y)}catch(V){w4T(V,HQ_)}},Yfe=function(r){r=(new TextEncoder).encode(r).subarray(0,16);
var D=new Uint8Array(16);D.set(r);return D},vw=function(r){this.W=r},LWc=function(r){var D=VUS[r];
if(D)return D;g.C0(new g.Vw("Entity model not found.",{entityType:r}))},TdW=function(r,D){this.W=r;
this.T=D;this.L={}},x9W=function(r,D){a:{r=I__(r.T,D.version);
try{var Y=r.T(D.data,D.key);break a}catch(V){w4T(V,f4c)}Y=void 0}return Y},bj=function(r,D,Y){return r.W.objectStore("EntityStore").get(D).then(function(V){if(V){if(Y&&V.entityType!==Y)throw Error("Incorrect entity type");
return x9W(r,V)}})},eY=function(r,D,Y){return Y?(Y=Y.map(function(V){return bj(r,V,D)}),g.lw.all(Y)):r.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(D)).then(function(V){return V.map(function(L){return x9W(r,L)})})},CI=function(r,D,Y){var V=ZQr(D),L=I__(r.T,1),T=Object.assign({},D);
return r.W.objectStore("EntityStore").get(V).then(function(I){if(I){if(I.entityType!==Y)throw Error("Incorrect entity type");T.entityMetadata||(I=x9W(r,I),T.entityMetadata=I.entityMetadata)}}).then(function(){var I={key:V,
entityType:Y,data:D9_(L,T,V),version:1};return g.lw.all([g.eP(r.W.objectStore("EntityStore"),I),Bdr(r,T,Y)])}).then(function(){cw(r,V,Y);
return V})},m9q=function(r,D,Y){D=D.map(function(V){return CI(r,V,Y)});
return g.lw.all(D)},Zu=function(r,D,Y){if(Y==null?0:Y.IB){var V=new Set;
return G_T(r,D,V).then(function(){for(var T=[],I=g.F(V),B=I.next();!B.done;B=I.next())T.push(Zu(r,B.value));return g.lw.all(T).then(function(){})})}var L=g.yI(D).entityType;
return g.lw.all([r.W.objectStore("EntityStore").delete(D),MUx(r,D)]).then(function(){cw(r,D,L)})},ja0=function(r,D){return g.nL(r.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(D)},function(Y){return g.lw.all([Y.delete(),
MUx(r,Y.cursor.primaryKey)]).then(function(){cw(r,Y.cursor.primaryKey,D);return g.oW(Y)})})},Qaq=function(r,D,Y,V){var L=I__(r.T,1);
return bj(r,D,V).then(function(T){if(T){T=g.Ap(T,Y);var I={key:D,entityType:V,data:D9_(L,T,D),version:1};return g.lw.all([g.eP(r.W.objectStore("EntityStore"),I),Bdr(r,T,V)])}}).then(function(){cw(r,D,V);
return D})},cw=function(r,D,Y){var V=r.L[Y];
V||(V=new Set,r.L[Y]=V);V.add(D)},sae=function(r,D,Y){var V=ZQr(D);
Y=LWc(Y);if(!Y)return g.lw.resolve([]);Y=new Y(D);r=r.W.objectStore("EntityAssociationStore");D=[];Y=g.F(Y.T());for(var L=Y.next();!L.done;L=Y.next())D.push(g.eP(r,{parentEntityKey:V,childEntityKey:L.value}));return g.lw.all(D).then(function(T){return T.map(function(I){return I[1]})})},MUx=function(r,D){return r.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(D))},Bdr=function(r,D,Y){var V=ZQr(D);
return MUx(r,V).then(function(){return sae(r,D,Y)})},G_T=function(r,D,Y){if(Y.has(D))return g.lw.resolve(void 0);
Y.add(D);return y1M(r,D).then(function(V){return r.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(D)).then(function(){return V})}).then(function(V){var L=g.lw.resolve(void 0);
V=g.F(V);for(var T=V.next(),I={};!T.done;I={uT:void 0},T=V.next())I.uT=T.value,L=L.then(function(B){return function(){return G_T(r,B.uT,Y)}}(I));
return L}).then(function(){})},y1M=function(r,D){var Y=r.W.objectStore("EntityAssociationStore");
return Y.index("byParentEntityKey").getAll(IDBKeyRange.only(D)).then(function(V){var L=[];V=g.F(V);for(var T=V.next();!T.done;T=V.next())T=T.value,L.push(Y.index("byChildEntityKey").getAll(T.childEntityKey));return g.lw.all(L)}).then(function(V){var L=[];
V=g.F(V);for(var T=V.next();!T.done;T=V.next())T=T.value,T.length===1&&L.push(T[0].childEntityKey);return L})},X0=function(){},a_W=function(){this.W={};
this.W[0]=new X0;if(!g.ti("aes_pes_encoder_killswitch")){var r=this.W;try{var D=g.LL();var Y=Yfe(D);var V=new vw(new g.Kh(Y),new g.Jb(Y))}catch(L){throw r=L instanceof Error?new Nv("KEY_CREATION_FAILED",{s_:L.message}):new Nv("KEY_CREATION_FAILED"),g.c1(r),r;}r[1]=V}},I__=function(r,D){D=D===void 0?0:D;
r=r.W[D];if(!r)throw D=new Nv("INVALID_ENCODER_VERSION",{t1:D}),g.c1(D),D;return r},oy=function(r,D){g.N.call(this);
this.token=r;this.W=D;this.observers=[];r=new g.vW.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.LL());r.onmessage=this.T.bind(this);this.channel=r},Pw=function(r,D,Y){var V,L,T,I;
return g.E(function(B){if(B.W==1)return g.K(B,oFS(r.token),2);if(B.W!=3)return V=B.T,g.K(B,g.bw(V,["EntityStore","EntityAssociationStore"],D,function(m){L=new TdW(m,r.W);return Y(L)}),3);
T=B.T;L&&(I=L.L,Object.keys(I).length>0&&(r.channel.postMessage(I),WWT(r,I)));return B.return(T)})},nI=function(r,D,Y){return Pw(r,{mode:"readwrite",
Hk:!0},function(V){return CI(V,D,Y)})},U9S=function(r,D){return Pw(r,{mode:"readwrite",
Hk:!0},function(Y){return m9q(Y,D,"offlineOrchestrationActionWrapperEntity")})},FWS=function(r,D){return Pw(r,{mode:"readwrite",
Hk:!0},function(Y){return Zu(Y,D)})},uzq=function(r){return Pw(r,{mode:"readwrite",
Hk:!0},function(D){return ja0(D,"videoPlaybackPositionEntity")})},Hw=function(r,D,Y){return Pw(r,{mode:"readonly",
Hk:!0},function(V){return bj(V,D,Y)})},fI=function(r,D,Y){return Pw(r,{mode:"readonly",
Hk:!0},function(V){return eY(V,D,Y)})},WWT=function(r,D){r=g.F(r.observers);
for(var Y=r.next();!Y.done;Y=r.next())Y=Y.value,Y(D)},qfS=function(){var r,D,Y;
return g.E(function(V){if(V.W==1)return g.q6(V,2),g.K(V,g.Bh(),4);if(V.W!=2){r=V.T;if(!r||!g.Tf()||typeof g.vW.BroadcastChannel==="undefined")return V.return();D=new a_W;return V.return(new oy(r,D))}Y=g.$w(V);Y instanceof Error&&g.c1(Y);return V.return()})},wa=function(){k_e||(k_e=qfS());
return k_e},gOR=function(r){var D;
r=(D=r.options)==null?void 0:D.persistenceOption;return r==="ENTITY_PERSISTENCE_OPTION_PERSIST"||r==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},$9W=function(r){var D;
return g.E(function(Y){return Y.W==1?g.K(Y,wa(),2):(D=Y.T)?g.K(Y,Pw(D,"readwrite",function(V){for(var L={},T=g.F(r),I=T.next(),B={};!I.done;B={ue:void 0,Wm:void 0},I=T.next())B.ue=I.value,B.ue.entityKey&&gOR(B.ue)&&(B.Wm=g.pB(B.ue.payload),I=void 0,B.ue.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(I=function(m){return function(){return CI(V,m.ue.payload[m.Wm],m.Wm)}}(B)),B.ue.type==="ENTITY_MUTATION_TYPE_DELETE"&&(I=function(m){return function(){return Zu(V,m.ue.entityKey)}}(B)),B.ue.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(I=function(m){return function(){return Qaq(V,m.ue.entityKey,m.ue.payload[m.Wm],m.Wm)}}(B)),I&&(L[B.ue.entityKey]=L[B.ue.entityKey]?L[B.ue.entityKey].then(I):I()));
return g.lw.all(Object.values(L))}),0):Y.return()})},A10=function(r){var D;
return g.E(function(Y){if(Y.W==1){D=r.mutations;if(!D||D.length<=0)return Y.return();if(g.xP){var V={type:"ENTITY_LOADED"};D!==void 0&&(V.payload=D);g.xP.dispatch(V)}return g.K(Y,$9W(D),2)}D.length=0;g.uf(Y)})},O6q=function(r){return r!==void 0},pER=function(r){var D=g.Ea();
D=Object.assign({},D);r=Object.assign({},r);for(var Y in D)r[Y]?(D[Y]!==4&&(D[Y]=r[Y]),delete r[Y]):D[Y]!==2&&(D[Y]=4);Object.assign(D,r);g.Loz(D);JSON.stringify(D);return D},hES=function(r){var D,Y;
return g.E(function(V){if(V.W==1)return g.K(V,g.Bh(),2);if(V.W!=3)return(D=V.T)?g.K(V,g.dm(D),3):V.return();Y=V.T;return V.return(g.bw(Y,["index","media","captions"],{mode:"readwrite",Hk:!0},function(L){var T=IDBKeyRange.bound(r+"|",r+"~");L=[L.objectStore("index").delete(T),L.objectStore("media").delete(T),L.objectStore("captions").delete(T)];return g.lw.all(L).then(function(){})}))})},tUM=function(){var r,D;
return g.E(function(Y){if(Y.W==1)return g.K(Y,g.Bh(),2);if(Y.W!=3){r=Y.T;if(!r)throw g.Jc("rvdfd");return g.K(Y,g.dm(r),3)}D=Y.T;return Y.return(g.bw(D,["index","media"],{mode:"readwrite",Hk:!0},function(V){var L={};return g.XS(V.objectStore("index"),{},function(T){var I=T.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),B=g.lw.resolve(void 0);if(I){var m=I[1];I=I[2];L[m]=L[m]||{};var G;L[m][I]=g.mGW((G=T.getValue())==null?void 0:G.fmts)}else B=T.delete().then(function(){});
return g.lw.all([g.oW(T),B]).then(function(M){return g.F(M).next().value})}).then(function(){for(var T={},I=g.F(Object.keys(L)),B=I.next();!B.done;B=I.next()){B=B.value;
var m=L[B].v;T[B]=L[B].a&&m?1:2}var G=pER(T);return g.S3x(V.objectStore("media"),{},function(M){var Q=M.cursor.key.match(g.Q0z);Q&&T[Q[1]]||V.objectStore("media").delete(M.cursor.key);return g.t94(M)}).then(function(){return G})})}))})},i6M=function(r,D){var Y,V;
return g.E(function(L){if(L.W==1)return g.K(L,g.Bh(),2);if(L.W!=3){Y=L.T;if(!Y)throw g.Jc("wct");return g.K(L,g.dm(Y),3)}V=L.T;return g.K(L,g.bw(V,["captions"],{mode:"readwrite",Hk:!0},function(T){var I=[];T=T.objectStore("captions");for(var B=0;B<D.length;B++){var m=g.eP(T,D[B],r+"|"+D[B].metadata.vss_id);I.push(m)}return g.lw.all(I)}),0)})},J1S=function(r){var D,Y,V;
return g.E(function(L){if(L.W==1)return D=IDBKeyRange.bound(r+"|",r+"~"),g.K(L,g.Bh(),2);if(L.W!=3){Y=L.T;if(!Y)throw g.Jc("gactfv");return g.K(L,g.dm(Y),3)}V=L.T;return L.return(V.getAll("captions",D))})},KW5=function(r){return g.E(function(D){g.zp(r,0);
return D.return(hES(r))})},l_S=function(r){return{context:g.I6(),
videoIds:r}},EOM=function(r){return{context:g.I6(),
playlistIds:r}},REe=function(r){return{context:g.I6(),
offlinePlaylistSyncChecks:r}},zEa=function(){this.W=new Map},SfW=function(){d9r||(d9r=new zEa);
return d9r},NdS=function(r,D){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:r},metadata:D,statusCode:void 0,csn:void 0,can:void 0}},vOc=function(r,D,Y){if(!Y){var V=V===void 0?!1:V;
Y=r.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Y||V)Y=g.l6(16),r.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Y)}r={flowNonce:Y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:D.eventType};D.metadata&&(r.flowMetadata=D.metadata);D.statusCode!==void 0&&(r.flowEventStatus=D.statusCode);D.csn&&(r.csn=D.csn);D.can&&(r.can=D.can);g.FS("flowEvent",r,void 0)},b6S=function(r){var D,Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS,O,h,J;
return g.E(function(R){if(R.W==1)return g.K(R,Pw(r,{mode:"readonly",Hk:!0},function(S){return eY(S,"playbackData").then(function(Dx){var TY=Dx.map(function(WW){return WW.transfer}).filter(function(WW){return!!WW}),Io=Dx.map(function(WW){return WW.offlineVideoPolicy}).filter(function(WW){return!!WW}),z=Dx.filter(function(WW){return!!WW.key}).map(function(WW){return g.ah(g.yI(WW.key).entityId,"downloadStatusEntity")});
TY=eY(S,"transfer",TY);Io=eY(S,"offlineVideoPolicy",Io);z=eY(S,"downloadStatusEntity",z);var M6=TY.then(function(WW){WW=WW.reduce(function(mz,Ky){(Ky==null?0:Ky.offlineVideoStreams)&&mz.push.apply(mz,g.k(Ky.offlineVideoStreams));return mz},[]).filter(function(mz){return!!mz});
return eY(S,"offlineVideoStreams",WW)});
return g.lw.all([TY,Io,M6,z]).then(function(WW){var mz=g.F(WW);WW=mz.next().value;var Ky=mz.next().value;var yW=mz.next().value;mz=mz.next().value;return[Dx,WW,Ky,yW,mz]})})}),2);
if(R.W!=3)return D=R.T,g.K(R,Pw(r,{mode:"readonly",Hk:!0},function(S){return eY(S,"mainDownloadsListEntity").then(function(Dx){var TY,Io;return(Io=(TY=Dx[0])==null?void 0:TY.downloads)!=null?Io:[]})}),3);
Y=R.T;V=g.F(D);L=V.next().value;T=V.next().value;I=V.next().value;B=V.next().value;m=V.next().value;G=L;M=T;Q=I;y=B;a=m;W={};q={};A={};p={};t={};l=[];d=g.F(M);for(b=d.next();!b.done;b=d.next())(n=b.value)&&(W[n.key]=n);P=g.F(Q);for(Ly=P.next();!Ly.done;Ly=P.next())(xw=Ly.value)&&(q[xw.key]=xw);rQ=g.F(a);for(c=rQ.next();!c.done;c=rQ.next())(w=c.value)&&(A[w.key]=w);u=g.F(y);for(C=u.next();!C.done;C=u.next())(bf=C.value)&&(p[bf.key]=bf);kc=g.F(Y);for(s_=kc.next();!s_.done;s_=kc.next())py=s_.value,fy=
void 0,t[(fy=py.videoItem)!=null?fy:""]=!0,py.videoItem&&(WS=IR=void 0,O=(WS=(IR=g.yI(py.videoItem))==null?void 0:IR.entityId)!=null?WS:"",l.push({externalVideoId:O}));h=G.filter(function(S){if(!S||!S.key||!S.offlineVideoPolicy)return!1;S=g.yI(S.key).entityId;S=g.ah(S,"downloadStatusEntity");var Dx;return!(S&&((Dx=A[S])==null?void 0:Dx.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
J=h.map(function(S){var Dx=W[S.transfer],TY=[];if(Dx==null?0:Dx.offlineVideoStreams)for(var Io=g.F(Dx.offlineVideoStreams),z=Io.next();!z.done;z=Io.next())(z=p[z.value])&&TY.push(z);Io=q[S.offlineVideoPolicy];z=t;var M6=S==null?void 0:S.playerResponseTimestamp,WW=g.yI(Io.key).entityId;S=g.ah(WW,"mainVideoEntity");if(Io.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var mz="OFFLINE_VIDEO_STATE_DISABLED";Io.expirationTimestamp&&Number(Io.expirationTimestamp)<Date.now()/1E3&&(mz="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Io.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")mz="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Dx==null?void 0:Dx.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":mz="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":mz="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":mz="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":mz="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":mz="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":mz="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:mz="OFFLINE_VIDEO_STATE_UNKNOWN"}if(mz==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Dx==null?void 0:Dx.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":mz="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":mz="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":mz=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}WW={id:WW,videoState:mz};if(Dx==null?0:Dx.cotn)WW.cotn=Dx.cotn;if(Dx==null?0:Dx.maximumDownloadQuality)WW.selectedVideoQuality=Dx==null?void 0:Dx.maximumDownloadQuality;if(Dx==null?0:Dx.lastProgressTimeMs)WW.lastProgressTimeMs=Dx.lastProgressTimeMs;M6&&(WW.playerResponseSavedTimeMs=String(Number(M6)*1E3));Dx=String;M6=0;TY=g.F(TY);for(mz=TY.next();!mz.done;mz=TY.next())if(mz=mz.value,mz.streamsProgress){mz=g.F(mz.streamsProgress);for(var Ky=mz.next();!Ky.done;Ky=
mz.next()){var yW=void 0;M6+=Number((yW=Ky.value.numBytesDownloaded)!=null?yW:0)}}WW.downloadedBytes=Dx(M6);WW.selectedOfflineMode=z[S]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Io.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(WW.offlinePlaybackDisabledReason=Io.offlinePlaybackDisabledReason);return WW});
return R.return({offlineVideos:J,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:l}}})})},eEx=function(){this.locks=navigator.locks},c1R=function(){try{var r=g.cW("ytglobal.locks_");
if(r)return r;var D;if(D=navigator){var Y=navigator;D="locks"in Y&&!!Y.locks}if(D)return g.vW.localStorage&&g.vW.localStorage.getItem("noop"),r=new eEx,g.eZ("ytglobal.locks_",r),r}catch(V){}},rs=function(){},CcM=function(){},Z6W=function(r){if(r.includes(":"))throw Error("Invalid user cache name: "+r);
return r+":"+g.LL("CacheStorage get")},XEa=function(){return g.E(function(r){if(Dp!==void 0)return r.return(Dp);
Dp=new Promise(function(D){var Y;return g.E(function(V){switch(V.W){case 1:return g.q6(V,2),g.K(V,YE.open("test-only"),4);case 4:return g.K(V,YE.delete("test-only"),5);case 5:g.gQ(V,3);break;case 2:if(Y=g.$w(V),Y instanceof Error&&Y.name==="SecurityError")return D(!1),V.return();case 3:D("caches"in window),g.uf(V)}})});
return r.return(Dp)})},PcT=function(){return g.E(function(r){if(r.W==1)return g.K(r,XEa(),2);
if(!r.T)return r.return(void 0);oOq||(oOq=new CcM);return r.return(oOq)})},Vq=function(r,D,Y){g.C0(new g.Vw("Woffle: "+r,Y?{cotn:Y}:""));
D instanceof Error&&g.C0(D)},nOr=function(r){var D;
return g.E(function(Y){if(Y.W==1)return g.K(Y,b6S(r),2);D=Y.T;g.FS("offlineStateSnapshot",D);g.uf(Y)})},L2=function(r){g.N.call(this);
var D=this;this.api=r;this.LC={qsD:function(){return D.W},
tx_:function(){return D.T}};
typeof g.vW.BroadcastChannel!=="undefined"&&(this.W=new g.vW.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.LL()),this.W.onmessage=this.L.bind(this),this.T=new g.vW.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.LL()),this.T.onmessage=this.S.bind(this))},Te=function(r,D){r.api.KP("onOfflineOperationFailure",D);
var Y;(Y=r.W)==null||Y.postMessage(D)},H6r=function(r,D,Y,V){var L=this;
this.K=r;this.Y=D;this.visibility=Y;this.V=V;this.j=this.N=this.D=this.L=this.W=!1;this.S=new g.LN(function(){L.PZ()});
this.LC={xF:function(){return L.T},
PZ:function(){L.PZ()},
gfo:function(){return L.S}};
this.visibility.subscribe("visibilitystatechange",function(){L.EY()})},f_q=function(r){if(!r.L&&!r.W){var D=c1R();
if(D){r.L=!0;var Y=g.LL("OfflineLockManager");D.request("woffle_orchestration_leader:"+Y,{},function(){var V,L,T,I;return g.E(function(B){switch(B.W){case 1:return g.q6(B,2),r.T=new g.gt,r.W=!0,r.L=!1,g.K(B,r.K(),4);case 4:return g.K(B,r.T.promise,5);case 5:g.gQ(B,0);break;case 2:V=g.$w(B),((T=(L=r).V)==null?0:T.call(L,"wo_relinquish_leadership_on_lock_request_error"))||r.PZ(),V instanceof Error&&(I=V,I.args=[{name:"WoLockManagerError",uP:V.name}],g.c1(I)),g.uf(B)}})})}}},wEr=function(r){r.W&&(r.j=
!0,ID(r))},ryR=function(r,D){r.W&&(r.D=D,ID(r))},DDS=function(r,D){r.W&&(r.N=D,ID(r))},ID=function(r){r.N&&r.D&&r.j&&r.visibility.isBackground()?g.TH(r.S,6E4):r.S.stop()},xE=function(r){var D;
r.offlineDeleteReason=(D=r.offlineDeleteReason)!=null?D:"OFFLINE_DELETE_REASON_UNKNOWN";var Y;r.offlineModeType=(Y=r.offlineModeType)!=null?Y:"OFFLINE_NOW";g.FS("offlineDeleteEvent",r)},Bp=function(r,D){var Y=D.videoId;
var V=D.cR;D=D.offlineModeType;r.encryptedVideoId=Y;r.cotn=V==null?void 0:V.cotn;r.offlineabilityFormatType=V==null?void 0:V.maximumDownloadQuality;var L;r.isRefresh=(L=V==null?void 0:V.isRefresh)!=null?L:!1;var T;r.softErrorCount=(T=V==null?void 0:V.transferRetryCount)!=null?T:0;r.offlineModeType=D!=null?D:"OFFLINE_NOW";(r.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&r.statusType==="UNKNOWN_STATUS_TYPE"||!r.transferStatusType&&!r.statusType)&&g.C0(Error("Woffle unknown transfer status"));
g.FS("offlineTransferStatusChanged",r)},YVS=function(r,D,Y,V){V={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!V};D&&Y&&(D=Math.floor(D/1024).toFixed(),Y=Math.floor(Y/1024).toFixed(),V.alreadyDownloadedKbytes=D,V.totalFetchedKbytes=D,V.totalContentKbytes=Y);Bp(V,r)},VVM=function(r){Bp({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},r)},LXT=function(r){switch(r){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
mY=function(r){var D,Y,V;
return((V=(D=r.actionMetadata)==null?void 0:(Y=D.retryScheduleIntervalsInSeconds)==null?void 0:Y.length)!=null?V:0)>0},Ge=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!r.entityKey},MR=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!r.entityKey},jf=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!r.entityKey},TfR=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!r.entityKey},
Qq=function(r,D,Y,V,L){L=L===void 0?!1:L;
var T,I,B,m,G,M;return g.E(function(Q){if(Q.W==1)return T=g.ah(r,D),I=g.ah(r,"downloadStatusEntity"),g.K(Q,Pw(Y,{mode:"readonly",Hk:!0},function(y){return g.lw.all([bj(y,T,D),bj(y,I,"downloadStatusEntity")])}),2);
B=Q.T;m=B.length?B[0]:void 0;if(!m)return Q.wT(0);G=I1e;if(M=B.length>1?B[1]:void 0){if(M.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!L)return Q.return();M.downloadState=V}else M={key:I,downloadState:V};g.n0(m,G,M);return g.K(Q,Pw(Y,{mode:"readwrite",Hk:!0},function(y){return g.lw.all([CI(y,m,D),CI(y,M,"downloadStatusEntity")])}),0)})},so=function(r,D){return r.actionType===D.actionType&&r.entityKey===D.entityKey},yq=function(r,D){if(r&&r.transferState!=="TRANSFER_STATE_COMPLETE"&&r.transferState!==
"TRANSFER_STATE_FAILED"){var Y=g.yI(r.key).entityId;
Bp({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Y,cR:r,offlineModeType:D})}},aD=function(r){if(!r||!r.thumbnails)return[];
var D=[];r=g.F(r.thumbnails);for(var Y=r.next();!Y.done;Y=r.next())Y=Y.value,Y.url&&D.push(Y.url);return D},xDS=function(r,D,Y){Y=Y===void 0?[]:Y;
var V,L,T,I,B,m,G,M,Q,y,a,W,q;return g.E(function(A){if(A.W==1)return Y.length?g.K(A,fI(r,D),2):A.return([]);V=A.T;L=new Set;T=g.F(V);for(I=T.next();!I.done;I=T.next())if(B=I.value,m=B.id||B.key)G=g.yI(m).entityId,L.add(G);M=[];Q=g.F(Y);for(y=Q.next();!y.done;y=Q.next())a=y.value,W=a.offlineVideoData,q=void 0,((q=W)==null?0:q.videoId)&&!L.has(W.videoId)&&M.push(a);return A.return(M)})},Bfc=function(r,D,Y){return new g.nX(r,{cotn:D,
raw_player_response:Y,download_media:!0,start:Infinity,disable_watch_next:!0})},mDM=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Wp=function(r,D,Y,V,L,T,I,B,m,G,M){this.entityType=r;
this.actionId=D;this.action=Y;this.parentActionId=V;this.rootActionId=L===void 0?D:L;this.childActionIds=T;this.prereqActionId=I;this.postreqActionIds=B;this.hasChildActionFailed=G;this.retryScheduleIndex=0;this.W=M||Date.now();this.retryScheduleIndex=m||0},Uo=function(r){if(!r.key)throw Error("Entity key is required.");
if(!r.actionProto)throw Error("OfflineOrchestrationAction is required.");var D=g.yI(r.key),Y=g.yI(r.actionProto.entityKey);return new Wp(Y.entityType,D.entityId,r.actionProto,r.parentActionId,r.rootActionId,r.childActionIds,r.prereqActionId,r.postreqActionIds,r.retryScheduleIndex,r.hasChildActionFailed,Number(r.enqueueTimeSec)*1E3)},F$=function(r){return{key:g.ah(r.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:r.action,parentActionId:r.parentActionId,rootActionId:r.rootActionId,childActionIds:r.childActionIds,prereqActionId:r.prereqActionId,postreqActionIds:r.postreqActionIds,retryScheduleIndex:r.retryScheduleIndex,hasChildActionFailed:r.hasChildActionFailed,enqueueTimeSec:(r.W/1E3).toFixed()}},Gir=function(){var r;
return g.E(function(D){return D.W==1?g.K(D,PcT(),2):(r=D.T)?D.return(r.delete("yt-player-local-img")):D.return(!0)})},uV=function(r){var D,Y;
return g.E(function(V){if(V.W==1)return g.K(V,PcT(),2);if(V.W!=3){D=V.T;if(!D)throw Error("Cache API not supported");return r.length?g.K(V,D.open("yt-player-local-img"),3):V.return()}Y=V.T;return g.K(V,Promise.all(r.map(function(L){return Y.delete(L)})),0)})},qR=function(r){var D,Y;
return g.E(function(V){if(V.W==1)return g.K(V,PcT(),2);if(V.W!=3){D=V.T;if(!D)throw Error("Cache API not supported");return r.length?g.K(V,D.open("yt-player-local-img"),3):V.return()}Y=V.T;return g.K(V,Y.addAll(r),0)})},kE=function(r,D,Y,V,L){var T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy;
return g.E(function(IR){switch(IR.W){case 1:return T=g.ah(r,"mainVideoEntity"),I=g.ah(r,"ytMainChannelEntity"),B=g.ah(r,"transfer"),m=g.ah(r,"videoDownloadContextEntity"),g.K(IR,Pw(D,{mode:"readonly",Hk:!0},function(WS){return g.lw.all([bj(WS,T,"mainVideoEntity"),bj(WS,I,"ytMainChannelEntity"),bj(WS,B,"transfer"),bj(WS,m,"videoDownloadContextEntity"),eY(WS,"ytMainChannelEntity"),eY(WS,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=IR.T;M=g.F(G);Q=M.next().value;y=M.next().value;a=M.next().value;W=M.next().value;q=M.next().value;A=M.next().value;p=Q;t=y;l=a;d=W;b=q;n=A;if(!p&&!t){IR.wT(3);break}P=p?aD(p.thumbnail):[];if(!t){Ly=[];IR.wT(4);break}return g.K(IR,MVM(t,b),5);case 5:Ly=IR.T;case 4:return xw=Ly,g.K(IR,uV(P.concat(xw)),3);case 3:rQ=[];c=g.ah(r,"downloadStatusEntity");w=g.F(n);for(u=w.next();!u.done;u=w.next())C=u.value,bf=g.yI(C.key).entityId,kc=Uo(C),s_=g.yI(kc.action.entityKey).entityId,bf!==r&&s_!==r||so(Y,
C.actionProto)||rQ.push(C.key);return g.K(IR,Pw(D,{mode:"readwrite",Hk:!0},function(WS){var O=rQ.map(function(h){return Zu(WS,h)});
O.push(Zu(WS,T,{IB:!0}));O.push(Zu(WS,c,{IB:!0}));return g.lw.all(O)}),7);
case 7:fy=(py=d)==null?void 0:py.offlineModeType,L&&(xE(L),L.offlineModeType&&(fy=L.offlineModeType)),yq(l,fy),Te(V,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.uf(IR)}})},sX_=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS,O,h,J,R,S,Dx,TY,Io,z,M6,WW,mz,Ky,yW,Nx,sq;
return g.E(function(Zx){switch(Zx.W){case 1:return L=g.ah(r,"mainPlaylistEntity"),T=g.ah(r,"ytMainChannelEntity"),g.K(Zx,Pw(D,{mode:"readonly",Hk:!0},function(vR){return g.lw.all([bj(vR,L,"mainPlaylistEntity"),bj(vR,T,"ytMainChannelEntity"),eY(vR,"mainPlaylistEntity"),eY(vR,"mainDownloadsListEntity"),eY(vR,"ytMainChannelEntity"),eY(vR,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:I=Zx.T;B=g.F(I);m=B.next().value;G=B.next().value;M=B.next().value;Q=B.next().value;y=B.next().value;a=B.next().value;W=m;q=G;A=M;p=Q;t=y;l=a;if(!W&&!q){Zx.wT(3);break}d=W?jXR(W):[];if(!q){b=[];Zx.wT(4);break}return g.K(Zx,MVM(q,t),5);case 5:b=Zx.T;case 4:return n=b,g.K(Zx,uV(d.concat(n)),3);case 3:P=[];Ly=new Map;if(!W){Zx.wT(7);break}return g.K(Zx,QXS(W,A,p),8);case 8:P=Zx.T;xw=g.F(P);for(rQ=xw.next();!rQ.done;rQ=xw.next())c=rQ.value,Ly.set(c,{videoId:c,playlistId:r,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.K(Zx,Pw(D,{mode:"readonly",Hk:!0},function(vR){return g.lw.all([eY(vR,"transfer"),eY(vR,"videoDownloadContextEntity")])}),9);
case 9:w=Zx.T;u=g.F(w);C=u.next().value;bf=u.next().value;kc=C;s_=bf;py=g.F(kc);for(fy=py.next();!fy.done;fy=py.next())IR=fy.value,WS=g.yI(IR.key).entityId,(O=Ly.get(WS))&&IR&&(O.cotn=IR.cotn);h=g.F(s_);for(J=h.next();!J.done;J=h.next())R=J.value,S=g.yI(R.key).entityId,(Dx=Ly.get(S))&&R&&(Dx.offlineModeType=R.offlineModeType);case 7:TY=[];Io=g.F(l);for(z=Io.next();!z.done;z=Io.next())M6=z.value,WW=g.yI(M6.key).entityId,mz=Uo(M6),WW!==r&&mz.rootActionId!==r||so(Y,M6.actionProto)||TY.push(M6.key);Ky=
g.ah(r,"mainPlaylistEntity");return g.K(Zx,Pw(D,{mode:"readwrite",Hk:!0},function(vR){var Gg=TY.map(function(lv){return Zu(vR,lv)});
Gg.push(Zu(vR,Ky,{IB:!0}));return g.lw.all(Gg)}),10);
case 10:if(!W){Zx.wT(0);break}P.reverse();if(!P){Zx.wT(0);break}yW=g.F(P);Nx=yW.next();case 13:if(Nx.done){Zx.wT(0);break}sq=Nx.value;return g.K(Zx,kE(sq,D,Y,V,Ly.get(sq)),14);case 14:Nx=yW.next(),Zx.wT(13)}})},a15=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y;
return g.E(function(a){if(a.W==1)return L=g.ah("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),T=new Map,g.K(a,Pw(r,{mode:"readwrite",Hk:!0},function(W){var q=eY(W,"transfer"),A=eY(W,"offlineOrchestrationActionWrapperEntity"),p=eY(W,"videoDownloadContextEntity"),t=bj(W,L,"mainDownloadsListEntity");return g.lw.all([q,A,p,t]).then(function(l){l=g.F(l);var d=l.next().value;var b=l.next().value;var n=l.next().value;var P=l.next().value;l=yyq.map(function(xw){return ja0(W,xw)});
b=g.F(b);for(var Ly=b.next();!Ly.done;Ly=b.next())Ly=Ly.value,so(D,Ly.actionProto)||l.push(Zu(W,Ly.key,{IB:!0}));P&&(P.downloads=[],l.push(CI(W,P,"mainDownloadsListEntity")));if(n)for(n=g.F(n),P=n.next();!P.done;P=n.next())P=P.value,b=g.yI(P.key).entityId,b=g.ah(b,"transfer"),T.set(b,P.offlineModeType);return g.lw.all(l).then(function(){return d})})}),2);
I=a.T;B=g.F(I);for(m=B.next();!m.done;m=B.next())G=m.value,yq(G,T.get(G.key)),M=g.yI(G.key).entityId,Q={videoId:M,offlineDeleteReason:V,cotn:G.cotn,offlineModeType:T.get(G.key)},xE(Q),y=g.ah(M,"mainVideoEntity"),Te(Y,{entityKey:y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.K(a,Gir(),0)})},jXR=function(r,D){var Y=[];
if(r.thumbnailStyleData){r=g.F(r.thumbnailStyleData);for(var V=r.next();!V.done;V=r.next()){var L=void 0,T=void 0,I=void 0;Y=Y.concat(aD((L=V.value)==null?void 0:(T=L.value)==null?void 0:(I=T.collageThumbnail)==null?void 0:I.coverThumbnail))}}D=aD(D);return Y.concat(D)},QXS=function(r,D,Y){var V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw;
return g.E(function(rQ){V=[];L=new Set;if(Y.length)for(T=g.F(Y),I=T.next();!I.done;I=T.next())if(B=I.value,m=void 0,(m=B.downloads)==null?0:m.length)for(G=g.F(B.downloads),M=G.next();!M.done;M=G.next())Q=M.value,Q.videoItem&&(y=g.yI(Q.videoItem).entityId,L.add(y));if(r.videos){a=g.F(r.videos);for(W=a.next();!W.done;W=a.next())q=W.value,A=JSON.parse(g.yI(q).entityId),A.videoId&&!L.has(A.videoId)&&V.push(A.videoId);p=g.F(D);for(t=p.next();!t.done;t=p.next())if(l=t.value,l.key!==r.key&&(d=l.videos))for(b=
g.F(d),n=b.next();!n.done;n=b.next())P=n.value,Ly=JSON.parse(g.yI(P).entityId),Ly.videoId&&(xw=V.indexOf(Ly.videoId),xw!==-1&&V.splice(xw,1))}return rQ.return(V)})},MVM=function(r,D){var Y,V,L,T,I,B,m,G;
return g.E(function(M){Y=aD(r.avatar);V=g.F(D);for(L=V.next();!L.done;L=V.next())if(T=L.value,T.id!==r.id)for(I=g.F(aD(T.avatar)),B=I.next();!B.done;B=I.next())m=B.value,G=Y.indexOf(m),G!==-1&&Y.splice(G,1);return M.return(Y)})},WXM=function(r){var D;
return g.E(function(Y){D=g.e(r.frameworkUpdates,gs);return r.frameworkUpdates&&D?g.K(Y,A10(D),0):Y.return()})},FXc=function(r){var D;
if((D=r.onResponseReceivedActions)!=null&&D.length){var Y;r=(Y=g.e(g.e(r.onResponseReceivedActions[0],UDc),g.RfR))==null?void 0:Y.actions;if(r!=null&&r.length)return r}},ujq=function(r){var D,Y,V;
return g.E(function(L){if(L.W==1)return r?g.K(L,Hw(r,g.E8,"mainDownloadsListEntity"),2):L.return([]);D=L.T;return((Y=D)==null?0:(V=Y.downloads)==null?0:V.length)?L.return(D.downloads.map(function(T){var I;return(I=T.videoItem)!=null?I:""})):L.return([])})},ki_=function(r,D){var Y;
return g.E(function(V){return V.W==1?g.K(V,qVS(r,D),2):(Y=V.T)?g.K(V,Pw(r,{mode:"readwrite",Hk:!0},function(L){var T=[CI(L,Y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Y.mainDownloadsListEntity&&T.push(CI(L,Y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.lw.all(T)}),0):V.wT(0)})},qVS=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l;
return g.E(function(d){if(d.W==1)return Y=g.ah("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.ah("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.K(d,Pw(r,{mode:"readonly",Hk:!0},function(b){return g.lw.all([bj(b,Y,"mainDownloadsLibraryEntity"),bj(b,V,"mainDownloadsListEntity")])}),2);
L=d.T;T=g.F(L);I=T.next().value;B=T.next().value;m=I;G=B;m||(m={id:Y});M=g.F(D);for(Q=M.next();!Q.done;Q=M.next())if(y=Q.value,y===g.E8){if(m.smartDownloadsList)return d.return();m.smartDownloadsList=y}else if(a=g.yI(y).entityType,W={},a==="mainPlaylistEntity"?W.playlistItem=y:a==="mainVideoEntity"&&(W.videoItem=y),!g.lu(W)){q=void 0;if((q=G)==null?0:q.downloads){A=!1;p=g.F(G.downloads);for(t=p.next();!t.done;t=p.next())if(l=t.value,l.playlistItem===y||l.videoItem===y){A=!0;break}A||G.downloads.push(W)}else G=
{id:V,downloads:[W]};m.downloadsList=V}return d.return({mainDownloadsLibraryEntity:m,mainDownloadsListEntity:G})})},gdr=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A;
return g.E(function(p){if(p.W==1)return Y=g.ah("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.ah("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.K(p,Pw(r,{mode:"readonly",Hk:!0},function(t){return g.lw.all([bj(t,Y,"mainDownloadsLibraryEntity"),bj(t,V,"mainDownloadsListEntity"),bj(t,g.E8,"mainDownloadsListEntity")])}),2);
L=p.T;T=g.F(L);I=T.next().value;B=T.next().value;m=T.next().value;G=I;M=B;Q=m;if(!G)return p.wT(0);if(D===g.E8&&((y=Q)==null?0:y.downloads))Q.downloads=[];else if((a=M)==null?0:a.downloads)for(W=g.yI(D).entityType,q=0;q<M.downloads.length;q++)if(A=M.downloads[q],W==="mainVideoEntity"&&A.videoItem===D){M.downloads.splice(q,1);break}else if(W==="mainPlaylistEntity"&&A.playlistItem===D){M.downloads.splice(q,1);break}return g.K(p,Pw(r,{mode:"readwrite",Hk:!0},function(t){var l=[CI(t,G,"mainDownloadsLibraryEntity")];
M&&l.push(CI(t,M,"mainDownloadsListEntity"));Q&&l.push(CI(t,Q,"mainDownloadsListEntity"));return g.lw.all(l)}),0)})},$E=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y;
return g.E(function(a){if(a.W==1)return Y=g.ah(D,"transfer"),V=g.ah(D,"videoDownloadContextEntity"),g.K(a,Pw(r,{mode:"readonly",Hk:!0},function(W){return g.lw.all([bj(W,Y,"transfer"),bj(W,V,"videoDownloadContextEntity")])}),2);
L=a.T;T=g.F(L);I=T.next().value;B=T.next().value;m=I;G=B;y={videoId:D,cotn:(M=m)==null?void 0:M.cotn,offlineModeType:(Q=G)==null?void 0:Q.offlineModeType};return a.return(y)})},As=function(r,D,Y,V,L){var T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly;
return g.E(function(xw){switch(xw.W){case 1:return T=g.ah(r,"musicTrack"),I=g.ah(r,"transfer"),g.K(xw,Pw(D,{mode:"readonly",Hk:!0},function(rQ){return g.lw.all([bj(rQ,T,"musicTrack"),bj(rQ,I,"transfer"),eY(rQ,"musicTrack"),eY(rQ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=xw.T;m=g.F(B);G=m.next().value;M=m.next().value;Q=m.next().value;y=m.next().value;a=G;W=M;q=Q;A=y;if(!a){xw.wT(3);break}return g.K(xw,$D0(a,q),4);case 4:return p=xw.T,g.K(xw,uV(p),3);case 3:t=[];l=g.F(A);for(d=l.next();!d.done;d=l.next())b=d.value,n=g.yI(b.key).entityId,P=Uo(b),Ly=g.yI(P.action.entityKey).entityId,n!==r&&Ly!==r||so(Y,b.actionProto)||t.push(b.key);return g.K(xw,Pw(D,{mode:"readwrite",Hk:!0},function(rQ){var c=t.map(function(w){return Zu(rQ,w)});
c.push(Zu(rQ,T,{IB:!0}));return g.lw.all(c)}),6);
case 6:yq(W),L&&xE(L),Te(V,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.uf(xw)}})},Oo=function(r,D,Y,V,L){var T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS,O,h,J;
return g.E(function(R){switch(R.W){case 1:return T=g.ah(r,D),I=g.ah("music_downloads_library_id","musicDownloadsLibraryEntity"),g.K(R,Pw(Y,{mode:"readonly",Hk:!0},function(S){return g.lw.all([bj(S,T,D),bj(S,I,"musicDownloadsLibraryEntity"),eY(S,D),eY(S,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=R.T;m=g.F(B);G=m.next().value;M=m.next().value;Q=m.next().value;y=m.next().value;a=G;W=M;q=Q;A=y;if(!a){R.wT(3);break}return g.K(R,$D0(a,q),4);case 4:return p=R.T,g.K(R,uV(p),3);case 3:t=[];l=new Map;if(!a){R.wT(6);break}return g.K(R,AyS(a,q,W),7);case 7:t=R.T;d=g.F(t);for(b=d.next();!b.done;b=d.next())n=b.value,P=g.yI(n).entityId,l.set(P,{videoId:P,playlistId:r,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.K(R,fI(Y,"transfer"),8);case 8:for(Ly=R.T,xw=g.F(Ly),
rQ=xw.next();!rQ.done;rQ=xw.next())c=rQ.value,w=g.yI(c.key).entityId,(u=l.get(w))&&c&&(u.cotn=c.cotn);case 6:C=[];bf=g.F(A);for(kc=bf.next();!kc.done;kc=bf.next())s_=kc.value,py=g.yI(s_.key).entityId,fy=Uo(s_),py!==r&&fy.rootActionId!==r||so(V,s_.actionProto)||C.push(s_.key);IR=g.ah(r,D);return g.K(R,Pw(Y,{mode:"readwrite",Hk:!0},function(S){var Dx=C.map(function(TY){return Zu(S,TY)});
Dx.push(Zu(S,IR,{IB:!0}));return g.lw.all(Dx)}),9);
case 9:if(!a){R.wT(0);break}t.reverse();if(!t.length){R.wT(0);break}WS=g.F(t);O=WS.next();case 12:if(O.done){R.wT(0);break}h=O.value;J=g.yI(h).entityId;if(!J){R.wT(13);break}return g.K(R,As(J,Y,V,L,l.get(J)),13);case 13:O=WS.next(),R.wT(12)}})},p2=function(r,D,Y){var V,L,T,I,B,m,G;
return g.E(function(M){if(M.W==1)return g.K(M,Pw(r,{mode:"readwrite",Hk:!0},function(Q){var y=eY(Q,"transfer"),a=eY(Q,"offlineOrchestrationActionWrapperEntity");return g.lw.all([y,a]).then(function(W){W=g.F(W);var q=W.next().value;var A=W.next().value;W=OET.map(function(d){return ja0(Q,d)});
A=g.F(A);for(var p=A.next();!p.done;p=A.next()){p=p.value;var t=g.yI(p.actionProto.entityKey).entityType==="musicTrack",l=p.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";so(D,p.actionProto)||t&&(!t||l)||W.push(Zu(Q,p.key,{IB:!0}))}return g.lw.all(W).then(function(){return q})})}),2);
V=M.T;L=g.F(V);for(T=L.next();!T.done;T=L.next())I=T.value,yq(I),B=g.yI(I.key).entityId,m={videoId:B,offlineDeleteReason:void 0,cotn:I.cotn},xE(m),G=g.ah(B,"musicTrack"),Te(Y,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.K(M,Gir(),0)})},p8_=function(r){for(var D,Y=g.F(r.additionalMetadatas),V=Y.next();!V.done;V=Y.next())V=V.value,V.offlineMusicVideoData&&(D=V.offlineMusicVideoData);
var L,T,I,B,m;return{id:g.ah(r.videoId,"musicTrack"),videoId:r.videoId,title:r.title,thumbnailDetails:r.thumbnail,lengthMs:String(Number(r.lengthSeconds)*1E3),albumTitle:(L=D)==null?void 0:L.releaseTitle,musicVideoType:(T=D)==null?void 0:T.musicVideoType,contentRating:{explicitType:(I=D)==null?void 0:I.explicitType},artistNames:((B=D)==null?void 0:B.byline)||((m=D)==null?void 0:m.channelName),downloadMetadata:g.ah(r.videoId,"musicTrackDownloadMetadataEntity")}},AyS=function(r,D,Y){var V,L,T,I,B,m,
G,M,Q,y,a,W,q,A,p,t,l,d;
return g.E(function(b){V=[];L=new Set;if((T=Y)==null?0:(I=T.downloadedTracks)==null?0:I.length)for(B=g.F(Y.downloadedTracks),m=B.next();!m.done;m=B.next())G=m.value,L.add(G);if(r.tracks){M=g.F(r.tracks);for(Q=M.next();!Q.done;Q=M.next())y=Q.value,L.has(y)||V.push(y);a=g.F(D);for(W=a.next();!W.done;W=a.next())if(q=W.value,q.id!==r.id&&(A=q.tracks))for(p=g.F(A),t=p.next();!t.done;t=p.next())l=t.value,d=V.indexOf(l),d!==-1&&V.splice(d,1)}return b.return(V)})},$D0=function(r,D){var Y,V,L,T,I,B,m,G;
return g.E(function(M){Y=aD(r.thumbnailDetails);V=g.F(D);for(L=V.next();!L.done;L=V.next())if(T=L.value,T.id!==r.id)for(I=g.F(aD(T.thumbnailDetails)),B=I.next();!B.done;B=I.next())m=B.value,G=Y.indexOf(m),G!==-1&&Y.splice(G,1);return M.return(Y)})},hQq=function(r,D){var Y,V,L,T,I,B,m,G,M;
return g.E(function(Q){if(Q.W==1)return Y=g.ah("music_downloads_library_id","musicDownloadsLibraryEntity"),g.K(Q,Hw(r,Y,"musicDownloadsLibraryEntity"),2);(V=Q.T)||(V={id:Y});L=g.yI(D).entityType;L==="musicTrack"?(T=V.downloadedTracks)!=null&&T.includes(D)||(V.downloadedTracks=((I=V.downloadedTracks)!=null?I:[]).concat(D)):L==="musicPlaylist"?(B=V.downloadedPlaylists)!=null&&B.includes(D)||(V.downloadedPlaylists=((m=V.downloadedPlaylists)!=null?m:[]).concat(D)):L!=="musicAlbumRelease"||(G=V.downloadedAlbumReleases)!=
null&&G.includes(D)||(V.downloadedAlbumReleases=((M=V.downloadedAlbumReleases)!=null?M:[]).concat(D));return g.K(Q,nI(r,V,"musicDownloadsLibraryEntity"),0)})},tVr=function(r,D){var Y,V,L,T,I,B,m;
return g.E(function(G){if(G.W==1)return Y=g.ah("music_downloads_library_id","musicDownloadsLibraryEntity"),g.K(G,Hw(r,Y,"musicDownloadsLibraryEntity"),2);V=G.T;if(!V)return G.wT(0);L=g.yI(D).entityType;L==="musicTrack"?T=V.downloadedTracks:L==="musicPlaylist"&&(T=V.downloadedPlaylists);if((I=T)==null?0:I.length)for(B=0;B<T.length;B++)if(m=T[B],m===D){T.splice(B,1);break}return g.K(G,nI(r,V,"musicDownloadsLibraryEntity"),0)})},iER=function(r){var D=r.videos;
r=[];var Y=[];if(D){D=g.F(D);for(var V=D.next();!V.done;V=D.next()){var L=V.value.offlineVideoData.videoId;V=g.ah(L,"musicTrack");L=g.ah(L,"musicTrackDownloadMetadataEntity");r.push(V);Y.push(L)}}return{VE:r,nD:Y}},hs=function(r,D,Y){D={track:p8_(D)};
Y&&(D.playlistId=Y);if(r=g.e(r.actionMetadata,Jyx))D.maximumDownloadQuality=r.maximumDownloadQuality;return{musicTrackEntityActionMetadata:D}},l1c=function(r){var D,Y,V,L,T,I,B,m;
return g.E(function(G){switch(G.W){case 1:return D=g.sr(),Y=l_S(r),V=g.mU(KXS),g.q6(G,2),T={Bl:!0},g.K(G,g.LD(D,Y,V,void 0,T),4);case 4:L=G.T;g.gQ(G,3);break;case 2:I=g.$w(G);if(I instanceof g.Dm)throw B="GetOffline network manager error: "+I.message,Vq(B,I),Error(B);Vq("GetOffline fetch request error",I);throw Error("GetOffline fetch request error");case 3:m=ts(L);if(!L)throw Vq("Network request failed"),Error("Network request failed");if(m!==void 0)iV(m);else if(!L.videos||!L.videos.length)throw Vq("No data"),
Error("No data");return G.return(L.videos.map(function(M){return M.offlineVideoData}))}})},Ede=function(r){var D,Y,V,L,T,I,B,m;
return g.E(function(G){switch(G.W){case 1:return D=g.sr(),Y=EOM(r),V=g.mU(KXS),g.q6(G,2),T={Bl:!0},g.K(G,g.LD(D,Y,V,void 0,T),4);case 4:L=G.T;g.gQ(G,3);break;case 2:I=g.$w(G);if(I instanceof g.Dm)throw B="GetOffline network manager error for playlist: "+I.message,Vq(B,I),Error(B);Vq("GetOffline fetch request error for playlist",I);throw Error("GetOffline fetch request error for playlist");case 3:m=ts(L);if(!L)throw Vq("Network request failed for playlist"),Error("Network request failed for playlist");
if(m!==void 0)iV(m,"playlist");else if(!L.playlists||!L.playlists.length)throw Vq("No data for playlist"),Error("No data for playlist");return G.return(L.playlists.map(function(M){return M.offlinePlaylistData}))}})},zQS=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_;
return g.E(function(py){switch(py.W){case 1:return g.K(py,wa(),2);case 2:L=py.T;if(!L)return py.return([]);T=[];if((I=V)==null?0:I.length){T=V;py.wT(3);break}return g.K(py,fI(L,"mainPlaylistEntity"),4);case 4:T=py.T;case 3:if(!T.length)return py.return([]);B=[];m=Date.now()/1E3;G=g.F(T);M=G.next();case 5:if(M.done)return B.length?g.K(py,RQ5(B),10):py.return([]);Q=M.value;if(!Q.downloadState){y=void 0;py.wT(8);break}return g.K(py,Hw(L,Q.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:y=
py.T;case 8:a=y;W=void 0;A=(q=(W=Q)==null?void 0:W.entityMetadata)&&q.nextAutoRefreshIntervalSeconds?Number(q.nextAutoRefreshIntervalSeconds):NaN;p=Number.isNaN(A)?r:A;l=t=void 0;d=((t=a)==null?0:t.lastSyncedTimestampMillis)?Number((l=a)==null?void 0:l.lastSyncedTimestampMillis)/1E3:0;n=b=void 0;P=((b=a)==null?0:b.addedTimestampMillis)?Number((n=a)==null?void 0:n.addedTimestampMillis)/1E3:0;if(Y||!q||d+p<=m){Ly=[];xw=void 0;if((xw=Q.videos)==null?0:xw.length)for(rQ=g.F(Q.videos),c=rQ.next();!c.done;c=
rQ.next())w=c.value,u=JSON.parse(g.yI(w).entityId),u.videoId&&Ly.push(u.videoId);C="0";q&&(bf=void 0,C=String(Number((bf=q.offlineLastModifiedTimestampSeconds)!=null?bf:0).toFixed()));kc={playlistId:Q.playlistId,videoIds:Ly,offlineLastModifiedTimestamp:C,autoSync:D,offlineDateAddedTimestamp:String(P.toFixed())};B.push(kc)}M=G.next();py.wT(5);break;case 10:return s_=py.T,py.return(s_)}})},dDa=function(){var r,D,Y,V,L;
return g.E(function(T){if(T.W==1)return g.K(T,wa(),2);if(T.W!=3)return(r=T.T)?g.K(T,fI(r,"refresh"),3):T.return(!1);D=T.T;if((Y=D[0])==null||!Y.refreshTime)return T.return(!1);V=Number(D[0].refreshTime);L=Date.now()/1E3;return T.return(isFinite(V)&&L>=V)})},Nfe=function(r,D){var Y,V,L;
return g.E(function(T){switch(T.W){case 1:return g.q6(T,2),g.K(T,SV0(r,D),4);case 4:return V=T.T,g.K(T,WXM(V),5);case 5:Y=FXc(V);g.gQ(T,3);break;case 2:L=g.$w(T),Vq("getAndProcessSmartDownloadsResponse request or processing error",L);case 3:return T.return(Y)}})},vda=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_;
return g.E(function(py){switch(py.W){case 1:return g.K(py,wa(),2);case 2:L=py.T;if(!L)return py.return([]);T=[];if((I=V)==null?0:I.length){T=V;py.wT(3);break}return g.K(py,fI(L,"musicPlaylist"),4);case 4:T=py.T;case 3:if(!T.length)return py.return([]);B=[];m=Date.now()/1E3;G=g.F(T);M=G.next();case 5:if(M.done)return B.length?g.K(py,RQ5(B),10):py.return([]);Q=M.value;y=void 0;W=(a=(y=Q)==null?void 0:y.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;q=
Number.isNaN(W)?r:W;p=A=0;t="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!Q.downloadMetadata){py.wT(8);break}return g.K(py,Hw(L,Q.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:l=py.T,b=d=void 0,A=Number((b=(d=l)==null?void 0:d.addedTimestampMillis)!=null?b:"0")/1E3,P=n=void 0,p=Number((P=(n=l)==null?void 0:n.lastModifiedTimestampMillis)!=null?P:"0")/1E3,xw=Ly=void 0,t=(xw=(Ly=l)==null?void 0:Ly.syncState)!=null?xw:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:rQ=void 0;if(Y||t!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!a||Number((rQ=a.lastSyncedTimestampSeconds)!=null?rQ:0)+q<=m){c=[];w=void 0;if((w=Q.tracks)==null?0:w.length)for(u=g.F(Q.tracks),C=u.next();!C.done;C=u.next())bf=C.value,c.push(g.yI(bf).entityId);kc={playlistId:Q.playlistId,videoIds:c,offlineLastModifiedTimestamp:String(p.toFixed()),autoSync:D,offlineDateAddedTimestamp:String(A.toFixed())};B.push(kc)}M=G.next();py.wT(5);break;case 10:return s_=py.T,py.return(s_)}})},SV0=function(r,D){var Y,V,L,T,I,B,m,G,M,Q;
return g.E(function(y){switch(y.W){case 1:return Y=g.sr(),g.K(y,wa(),2);case 2:V=y.T;if(!V){y.wT(3);break}return g.K(y,b6S(V),4);case 4:L=y.T;case 3:var a=L;T={context:g.I6(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:r},offlineClientState:a,clientStateRequestData:{preferredFormatType:D}}}};I=g.mU(bE0);g.q6(y,5);m={Bl:!0};return g.K(y,g.LD(Y,T,I,void 0,m),7);case 7:B=y.T;g.gQ(y,6);break;case 5:G=g.$w(y);if(G instanceof g.Dm)throw M=
"DPS network manager error for smart downloads: "+G.message,Vq(M,G),Error(M);Vq("DPS fetch request error for smart downloads",G);throw Error("DPS fetch request error for smart downloads");case 6:Q=ts(B);if(B)Q!==void 0&&iV(Q,"smart downloads");else throw Vq("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return y.return(B)}})},cyS=function(r,D){var Y,V,L,T,I,B,m,G;
return g.E(function(M){switch(M.W){case 1:return Y=g.sr(),V={context:g.I6(),videoPlaybackPositionEntities:r,lastSyncTimestampUsec:D},L=g.mU(eQW),g.q6(M,2),I={Bl:!0},g.K(M,g.LD(Y,V,L,void 0,I),4);case 4:T=M.T;g.gQ(M,3);break;case 2:B=g.$w(M);if(B instanceof g.Dm)throw m="VPPS network manager error: "+B.message,Vq(m,B),Error(m);Vq("VPPS fetch request error",B);throw Error("VPPS fetch request error");case 3:G=ts(T);if(T)G!==void 0&&iV(G,"position sync");else throw Vq("Network request failed for position sync"),
Error("Network request failed for position sync");return M.return(T)}})},ZE0=function(r,D,Y){var V,L,T,I,B,m,G,M;
return g.E(function(Q){switch(Q.W){case 1:V=g.sr();var y=Y.refreshData,a=Y.isEnqueuedForExpiredStreamUrlRefetch,W=Y.Fw,q=Y.offlineSourceData,A=Y.mediaCapabilities,p={entityKey:r};y&&(p.refreshData=y);a&&(p.isExpiredStreamUrlRefetch=a);W&&(p.downloadParameters=W);q&&(p.offlineSourceData=q);y={context:g.G4(D),signatureTimestamp:20159,videos:[p]};A&&(y.mediaCapabilities=A);L=y;T=g.mU(Coe);g.q6(Q,2);B={Bl:!0};return g.K(Q,g.LD(V,L,T,void 0,B),4);case 4:I=Q.T;g.gQ(Q,3);break;case 2:m=g.$w(Q);if(m instanceof
g.Dm)throw G="GetPDE network manager error: "+m.message,Vq(G,m),Error(G);Vq("GetPDE fetch request error",m);throw Error("GetPDE fetch request error");case 3:M=ts(I);if(I)M!==void 0&&iV(M,"PDE");else throw Vq("Network request failed for PDE"),Error("Network request failed for PDE");return Q.return(I)}})},ts=function(r){var D;
return(D=r.errorMetadata)==null?void 0:D.status},iV=function(r,D){D=D?" for "+D:"";
if(r===0)throw r="Empty response body"+D,Vq(r),Error(r);r="Response with error"+D;Vq(r);throw Error(r);},RQ5=function(r){var D,Y,V,L,T,I,B,m;
return g.E(function(G){switch(G.W){case 1:return D=g.sr(),Y=REe(r),V=g.mU(X8c),g.q6(G,2),T={Bl:!0},g.K(G,g.LD(D,Y,V,void 0,T),4);case 4:L=G.T;g.gQ(G,3);break;case 2:I=g.$w(G);if(I instanceof g.Dm)throw B="offlinePlaylistSyncCheck network manager error: "+I.message,Vq(B,I),Error(B);Vq("offlinePlaylistSyncCheck fetch request error",I);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:m=ts(L);if(!L)throw Vq("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(m!==void 0)iV(m,"playlist sync");else if(!L.offlinePlaylistSyncCheckDatas||!L.offlinePlaylistSyncCheckDatas.length)throw Vq("No data for playlist sync"),Error("No data for playlist sync");return G.return(L.offlinePlaylistSyncCheckDatas.map(function(M){return M.offlinePlaylistSyncCheckData}))}})},Js=function(r){this.W=r},odS=function(r,D){var Y,V,L,T,I,B;
return g.E(function(m){switch(m.W){case 1:Y=new Map,V=g.F(D),L=V.next();case 2:if(L.done){m.wT(4);break}T=L.value;I=Y;B=I.set;return g.K(m,r.T(T),5);case 5:B.call(I,T,m.T);L=V.next();m.wT(2);break;case 4:return m.return(Y)}})},K2=function(r,D,Y,V,L,T){D=g.ah(D,Y);
V=Object.assign({},T,{priority:V,retryScheduleIntervalsInSeconds:L});return{actionType:r,entityKey:D,actionMetadata:V}},lV=function(r,D,Y,V,L,T){this.status=r;
this.W=D;this.S=Y;this.T=V;this.L=L;this.downloadState=T},PoM=function(r,D,Y){this.W=r;
this.ag=D;this.L=Y},f1S=function(r,D){var Y,V,L,T,I,B,m,G,M;
return g.E(function(Q){switch(Q.W){case 1:return Y=D.entityKey,L=(V=g.e(D.actionMetadata,Eo))==null?void 0:V.isEnqueuedForExpiredStreamUrlRefetch,g.q6(Q,2),T=void 0,g.K(Q,ndr(r,D),4);case 4:T=Q.T;g.q6(Q,5);var y=(y=g.e(D.actionMetadata,Eo))?{maximumDownloadQuality:y.maximumDownloadQuality}:void 0;return g.K(Q,ZE0(Y,r.ag,{isEnqueuedForExpiredStreamUrlRefetch:L,Fw:y,offlineSourceData:T}),7);case 7:I=Q.T;g.gQ(Q,6,2);break;case 5:return g.$w(Q,2),B=mY(D)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Vq("PDE handleAdd error"),Q.return(RD(D,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,"DOWNLOAD_STATE_FAILED"));case 6:return g.K(Q,HEW(r,I,D),8);case 8:return Q.return(RD(D,!0,I.orchestrationActions));case 2:return m=g.$w(Q),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.OZ&&m.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Vq("PDE handleAdd error"),Q.return(RD(D,!1,void 0,G,M,"DOWNLOAD_STATE_FAILED"))}})},DmR=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw;
return g.E(function(rQ){switch(rQ.W){case 1:return Y=D.entityKey,V=g.yI(Y).entityId,g.K(rQ,Pw(r.W,{mode:"readonly",Hk:!0},function(c){var w=bj(c,Y,"playbackData"),u=bj(c,g.ah(V,"offlineVideoPolicy"),"offlineVideoPolicy");c=bj(c,g.ah(V,"transfer"),"transfer");return g.lw.all([w,u,c])}),2);
case 2:L=rQ.T;T=g.F(L);I=T.next().value;B=T.next().value;m=T.next().value;G=I;M=B;Q=m;if(!G||!M)return rQ.return(RD(D,!0));y=[];q=((W=G)==null?0:W.playerResponseJson)?JSON.parse(G.playerResponseJson):null;if(!(Q&&q&&r.ag.V("html5_refresh_deprecated_downloads"))){rQ.wT(3);break}a=w8R(r,q,Q);return g.K(rQ,r7M(r,Q),4);case 4:y=rQ.T;case 3:A={lastPlayerResponseTimestampSeconds:G.playerResponseTimestamp,offlineToken:M.offlineToken,formatIds:y};p={};if((t=Q)==null?0:t.maximumDownloadQuality)p.maximumDownloadQuality=
Q.maximumDownloadQuality;g.q6(rQ,5);l=void 0;return g.K(rQ,ndr(r,D),7);case 7:return l=rQ.T,g.q6(rQ,8),g.K(rQ,ZE0(Y,r.ag,{refreshData:A,Fw:p,offlineSourceData:l,mediaCapabilities:a}),10);case 10:d=rQ.T;g.gQ(rQ,9,5);break;case 8:return g.$w(rQ,5),b=mY(D)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Vq("PDE handleRefresh error"),rQ.return(RD(D,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",b,
"DOWNLOAD_STATE_FAILED"));case 9:return g.K(rQ,HEW(r,d,D),11);case 11:return rQ.return(RD(D,!0,d.orchestrationActions));case 5:return n=g.$w(rQ),P="PDE handleRefresh error",n instanceof Error&&(P="PDE handleRefresh error: "+n.message),Ly="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",xw="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.OZ&&n.type==="QUOTA_EXCEEDED"&&(Ly="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",xw="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Vq(P),rQ.return(RD(D,!1,void 0,Ly,xw,"DOWNLOAD_STATE_FAILED"))}})},ndr=function(r,D){var Y,V,L,T;
return g.E(function(I){if(I.W==1)return Y=g.yI(D.entityKey).entityId,V=g.ah(Y,"videoDownloadContextEntity"),g.K(I,Hw(r.W,V,"videoDownloadContextEntity"),2);L=I.T;return(T=L)!=null&&T.offlineModeType?I.return({offlineModeType:L.offlineModeType}):I.return(void 0)})},HEW=function(r,D,Y){var V,L,T,I,B;
return g.E(function(m){if(m.W==1){if(!D.frameworkUpdates||!g.e(D.frameworkUpdates,gs))return m.return();if(!(g.e(D.frameworkUpdates,gs).mutations&&g.e(D.frameworkUpdates,gs).mutations.length>0&&g.e(D.frameworkUpdates,gs).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return m.wT(2);V=g.yI(g.e(D.frameworkUpdates,gs).mutations[0].entityKey).entityId;return g.K(m,$E(r.W,V),3)}if(m.W!=2){L=m.T;T=g.e(Y.actionMetadata,Eo);if(B=(I=T)==null?void 0:I.playlistId)L.playlistId=B;L.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.YA(r.ag)?g.K(m,kE(V,r.W,Y,r.L,L),2):g.Xg(r.ag)?g.K(m,As(V,r.W,Y,r.L),2):m.wT(2)}return g.K(m,A10(g.e(D.frameworkUpdates,gs)),0)})},RD=function(r,D,Y,V,L,T){return new lV(D?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",mY(r),Y,V,L,T)},w8R=function(r,D,Y){D=Bfc(r.ag,Y.cotn,D);
Y=g.Qb(D);return g.duf(D,Y,r.ag)},r7M=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y;
return g.E(function(a){if(a.W==1)return Y=[],g.K(a,Pw(r.W,{mode:"readonly",Hk:!0},function(W){var q=[],A=D.offlineVideoStreams;if(A){A=g.F(A);for(var p=A.next();!p.done;p=A.next())q.push(bj(W,p.value,"offlineVideoStreams"))}return g.lw.all(q)}),2);
if(V=a.T)for(L=g.F(V),T=L.next();!T.done;T=L.next())if(I=T.value,B=void 0,(B=I)==null?0:B.streamsProgress)for(m=I.streamsProgress,G=0;G<m.length;G++)M=m[G],Q=JSON.parse(M.formatStreamBytes),y={itag:Q.itag,lmt:Q.lastModified,xtags:Q.xtags},Y.push(y);return a.return(Y)})},YtT=function(r,D){this.W=r;
this.ag=D},VbM=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a;
return g.E(function(W){switch(W.W){case 1:return Y=mY(D),g.K(W,fI(r.W,"videoPlaybackPositionEntity"),2);case 2:V=W.T;if(V.length===0)return W.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.q6(W,3);return g.K(W,SY.getInstance(),5);case 5:L=W.T;if(!L)throw Error("prefStorage is undefined");return g.K(W,L.get("psi"),6);case 6:return T=W.T,m=(B=(I=T)==null?void 0:I.Tn)!=null?B:"0",g.K(W,cyS(V,m),7);case 7:return G=W.T,M={isPaused:G.watchHistoryPaused,Tn:G.syncTimestampUsec},g.K(W,L.set("psi",
M),8);case 8:if(M.isPaused){W.wT(9);break}Q=g.e(G.frameworkUpdates,gs);if(!G.frameworkUpdates||!Q){W.wT(9);break}return g.K(W,A10(Q),9);case 9:g.gQ(W,4);break;case 3:return y=g.$w(W),a="PPE handleRefresh error: "+(y instanceof Error?y.message:"unknown error"),Vq(a),W.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},TEc=function(r,D){var Y,V,L,T,I,B,m,G;
return g.E(function(M){switch(M.W){case 1:return Y=mY(D),V=g.yI(D.entityKey).entityId,g.q6(M,2),g.K(M,SY.getInstance(),4);case 4:L=M.T;if(!L)throw Error("prefStorage is undefined");return g.K(M,L.get("psi"),5);case 5:T=M.T;I=g.e(D.actionMetadata,Lcr);if(((B=T)==null?void 0:B.isPaused)!==!1||(m=I)==null||!m.lastPlaybackPositionSeconds){M.wT(6);break}G={key:g.ah(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:I.lastPlaybackPositionSeconds};return g.K(M,nI(r.W,G,"videoPlaybackPositionEntity"),
6);case 6:g.gQ(M,3);break;case 2:return g.$w(M),M.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},IHe=function(r,D){var Y,V,L;
return g.E(function(T){switch(T.W){case 1:Y=mY(D);g.q6(T,2);V=g.yI(D.entityKey).entityId;if(V==="!*$_ALL_ENTITIES_!*$")return g.K(T,uzq(r.W),5);L=g.ah(V,"videoPlaybackPositionEntity");return g.K(T,FWS(r.W,L),5);case 5:g.gQ(T,3);break;case 2:return g.$w(T),T.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},xmc=function(r,D){this.api=r;
this.W=D;this.logger=new g.G7("woffle");this.T=!1;this.LC={yM:this.yM};this.logger.debug("Initialized OfflineMediaManager")},BEa=function(r){return g.E(function(D){return D.return(KW5(r))})},mm5=function(r){var D;
return g.E(function(Y){if(Y.W==1)return g.K(Y,g.G6w(r),2);D=Y.T;return Y.return(D.filter(function(V){return!!V.url}).map(function(V){return V.url}))})},ze=function(r,D){var Y=g.Rm(D);
if(Y===1||Y===0)return Promise.resolve();(Y=Ghx(r,D))&&Y.stopVideo();r.L=0;return BEa(D)},ds=function(r,D,Y,V){Y=Y===void 0?!1:Y;
V=V===void 0?!0:V;var L=typeof D==="string"?D:D.videoDetails.videoId;g.Rm(L)===2&&((D=Ghx(r,L))?D.stopVideo():r.logger.info(function(){return"Corresponding player for "+L+" not found. Pausing anyway"}),g.zp(L,2),r.L=2,Y?Mb5(r.W):V&&jqS(r.W))},Ghx=function(r,D){var Y;
return((Y=r.player)==null?void 0:Y.getVideoData().videoId)===D?r.player:null},Qqr=function(r,D,Y){D.getPlayerResponse();
g.zp(D.videoId,2);r.L=2;r.T=!1;var V;(V=r.player)==null||V.dispose();r.player=r.api.cF(D);D={};r.player.Wd((D.localmediachange=r.hx,D.signatureexpired=r.Fn,D.statechange=r.Nkb,D),r);var L=r.yM(Y);r.player.MX(g.Mu(L,L,!0,"m"),!1);r.logger.debug(function(){return"Starting headless playback with quality: "+L});
r.player.tI(!1)},sq5=function(r,D){this.W=r;
this.ag=D},aH5=function(r,D){var Y,V;
return g.E(function(L){switch(L.W){case 1:return Y=mY(D),g.K(L,Hw(r.W,D.entityKey,"transfer"),2);case 2:if(V=L.T)return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.q6(L,3);return g.K(L,y7e(r,D),5);case 5:g.gQ(L,4);break;case 3:return g.$w(L),L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},WcT=function(r,D){var Y,V;
return g.E(function(L){switch(L.W){case 1:return Y=mY(D),g.K(L,Hw(r.W,D.entityKey,"transfer"),2);case 2:V=L.T;if(!V||V.transferState!=="TRANSFER_STATE_COMPLETE")return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.q6(L,3);return g.K(L,y7e(r,D,!0),5);case 5:g.gQ(L,4);break;case 3:return g.$w(L),L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},Umq=function(r,D){var Y,V,L,T,I,B,m,G,M,Q;
return g.E(function(y){switch(y.W){case 1:return Y=mY(D),V=g.yI(D.entityKey).entityId,g.K(y,Pw(r.W,{mode:"readonly",Hk:!0},function(a){var W=bj(a,D.entityKey,"transfer");a=bj(a,g.ah(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lw.all([W,a])}),2);
case 2:L=y.T;T=g.F(L);I=T.next().value;B=T.next().value;m=I;G=B;if(!m||m.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return y.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.q6(y,3);m.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.K(y,nI(r.W,m,"transfer"),5);case 5:M=g.yI(m.key).entityId;Bp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:M,cR:m,offlineModeType:(Q=G)==null?void 0:Q.offlineModeType});g.gQ(y,
4);break;case 3:return g.$w(y),y.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return y.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},y7e=function(r,D,Y){Y=Y===void 0?!1:Y;
var V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p;return g.E(function(t){switch(t.W){case 1:return V=g.e(D.actionMetadata,Fca),L=g.yI(D.entityKey).entityId,T=g.ah(L,"downloadStatusEntity"),g.K(t,Pw(r.W,{mode:"readonly",Hk:!0},function(l){var d=bj(l,T,"downloadStatusEntity");l=bj(l,g.ah(L,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lw.all([d,l])}),2);
case 2:return I=t.T,B=g.F(I),m=B.next().value,G=B.next().value,M=m,Q=G,y="TRANSFER_STATE_TRANSFER_IN_QUEUE",((a=M)==null?void 0:a.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(y="TRANSFER_STATE_PAUSED_BY_USER"),A={key:D.entityKey,transferState:y,cotn:g.l6(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(W=V)==null?void 0:W.maximumDownloadQuality,preferredAudioTrack:(q=V)==null?void 0:q.preferredAudioTrack,transferRetryCount:0,isRefresh:Y,hasLoggedFirstStarted:!1},g.K(t,Pw(r.W,
{mode:"readwrite",Hk:!0},function(l){var d=[];Y&&d.push(Zu(l,g.ah(L,"offlineVideoStreams")));d.push(CI(l,A,"transfer"));return g.lw.all(d)}),3);
case 3:if(!Y){t.wT(4);break}return g.K(t,BEa(L),4);case 4:Bp({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:L,cR:A,offlineModeType:(p=Q)==null?void 0:p.offlineModeType}),g.uf(t)}})},qta=function(r,D,Y,V){if(!r.action.entityKey)throw Error("entityKey is missing.");
var L=g.yI(r.action.entityKey);L={entityType:L.lB,entityId:L.entityId,offlineOrchestrationActionType:r.action.actionType,orchestrationAction:{orchestrationActionId:r.actionId}};D&&(L.offlineOrchestrationActionResult=D.status,L.isRetryable=Y?!1:D.W,D.L&&(L.offlineOrchestrationFailureReason=uBe(D.L,L.isRetryable)));var T,I;if((T=r.action.actionMetadata)==null?0:(I=T.offlineLoggingData)==null?0:I.offlineModeType)L.offlineModeType=r.action.actionMetadata.offlineLoggingData.offlineModeType;V&&(L.additionalOrchestrationActions=
V.map(function(B){return{orchestrationActionId:B.actionId}}));
return L},uBe=function(r,D){return r!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||D?r==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&D?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":r:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},khS=function(r,D){var Y={offlineOrchestrationContext:qta(r)};
D=NdS(D,Y);vOc(SfW(),D,r.rootActionId)},goM=function(r,D,Y,V){V=V===void 0?[]:V;
D={offlineOrchestrationContext:qta(r,D,Y,V)};D=NdS(3,D);vOc(SfW(),D,r.rootActionId)},$m0=function(){this.actions=[]},A7q=function(r,D){D=g.F(D);
for(var Y=D.next();!Y.done;Y=D.next())Y=Y.value,khS(Y,1),r.actions.push(Y);r.actions.sort(r.W)},O70=function(r,D){if(D)for(var Y=0;Y<r.actions.length;Y++)if(D==="!*$_ALL_ENTITIES_!*$"&&r.actions[Y].actionId!==D||D!=="!*$_ALL_ENTITIES_!*$"&&r.actions[Y].rootActionId===D&&r.actions[Y].actionId!==D)r.actions.splice(Y,1),Y--},p3r=function(r,D){r=g.F(r.actions);
for(var Y=r.next();!Y.done;Y=r.next())if(Y.value.actionId===D)return!0;return!1},Sf=function(r,D,Y,V,L){g.N.call(this);
var T=this;this.T=r;this.i$=D;this.Tv=Y;this.N=V;this.ag=L;this.W=new $m0;this.D=new g.LF;this.L=new g.LN(function(){T.retry()});
this.K=NaN;this.j=!1;this.LC={PvY:function(){return T.W},
lR:function(){return T.D},
Cv$:function(){return T.L},
retry:function(){return T.retry()}};
g.v(this,this.L);this.Y=this.T.observe(this.LP.bind(this))},i7R=function(r,D,Y,V,L){var T;
return g.E(function(I){if(I.W==1)return T=new Sf(r,D,Y,V,L),g.K(I,hoa(T),2);tbS(T);return I.return(T)})},tbS=function(r){var D=r.W.actions[0];
return r.S?((D==null?void 0:D.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&r.S[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(r.j=!0),Promise.resolve()):J7x(r)},J7x=function(r){var D,Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p;
return g.E(function(t){switch(t.W){case 1:if(r.S)throw Error("Already processing an action");if(r.DQ())return t.return();D=r.W.actions.shift();ryR(r.Tv,!D);if(D===void 0)return t.return();D.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&D.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&O70(r.W,D.actionId);Y="";D.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&D.rootActionId===D.actionId&&(Y=D.actionId);V=[D];r.S=V;if(L=r.i$[D.entityType]){t.wT(2);break}r.S=
void 0;return g.K(t,J7x(r),3);case 3:return t.return();case 2:T=g.F(V);for(I=T.next();!I.done;I=T.next())B=I.value,khS(B,2);g.q6(t,4,5);return g.K(t,odS(L,V.map(function(l){return l.action})),7);
case 7:m=t.T,G=g.F(V),M=G.next();case 8:if(M.done){t.wT(10);break}Q=M.value;y=m.get(Q.action);return g.K(t,KcM(r,Q,y),9);case 9:M=G.next();t.wT(8);break;case 10:O70(r.W,Y);case 5:g.Aa(t);r.S=void 0;g.OE(t,6);break;case 4:return a=g.$w(t),Vq("Orchestration error",a),g.q6(t,12),g.K(t,lHM(r,V),14);case 14:g.gQ(t,5);break;case 12:W=g.$w(t);Vq("Orchestration retry error",W);q=g.F(V);for(A=q.next();!A.done;A=q.next())p=A.value,p.retryScheduleIndex<3&&A7q(r.W,[p]);t.wT(5);break;case 6:return g.K(t,J7x(r),
0)}})},KcM=function(r,D,Y){var V,L,T,I,B,m,G,M,Q,y,a,W;
return g.E(function(q){switch(q.W){case 1:V=D.retryScheduleIndex+2===3;if(Y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){q.wT(2);break}if(Y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){q.wT(0);break}goM(D,Y,V);if(Y.W&&D.retryScheduleIndex+1<3)return g.K(q,lHM(r,[D]),0);T=((L=Y)==null?0:L.T)?Y.T:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";I={entityKey:D.action.entityKey,failureReason:T};B=void 0;g.YA(r.ag)?B="mainVideoDownloadStateEntity":g.Xg(r.ag)&&(B="musicTrackDownloadMetadataEntity");
if(!B||!Y.downloadState){q.wT(7);break}m=g.yI(D.action.entityKey).entityId;return g.K(q,Qq(m,B,r.T,Y.downloadState),7);case 7:Te(r.N,I);if(Y.downloadState==="DOWNLOAD_STATE_FAILED"&&r.ag.V("html5_auto_retry_failed_pde_actions")){q.wT(0);break}Vq("Orchestration result is not retryable, deleting action");return g.K(q,FWS(r.T,F$(D).key),0);case 2:G=void 0;try{G=(M=Y.S)==null?void 0:M.map(function(A){return r.createAction(A,D)})}catch(A){return goM(D,Y,V),Q={entityKey:D.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Te(r.N,Q),Vq("Orchestration subactions creation error",A),q.return()}goM(D,Y,V,G);if(!G){q.wT(12);break}y=G.map(function(A){return F$(A)});
a=0;case 13:if(!(a<G.length)||r.j){q.wT(15);break}return g.K(q,Pw(r.T,{mode:"readwrite",Hk:!0},function(A){var p=[];p.push(m9q(A,y.slice(a,a+10),"offlineOrchestrationActionWrapperEntity"));return g.lw.all(p)}),16);
case 16:a+=10;q.wT(13);break;case 15:if(r.j)return r.j=!1,q.return();case 12:return W=F$(D),g.K(q,FWS(r.T,W.key),17);case 17:khS(D,4),g.uf(q)}})},dmM=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a;
return g.E(function(W){Y=[];V=Infinity;L=4E3;T=g.F(D);for(I=T.next();!I.done;I=T.next())B=I.value,m=Number(B.enqueueTimeSec),G=Eox(m),M=B.retryScheduleIndex,Q=M!=null&&M>0,G>0&&Q?(V=Math.min(V,m),L=Math.min(G,L)):Y.push(B);isFinite(V)&&(!r.L.isActive()||V<r.K)&&(r.K=V,r.L.start(L));r.D.GD()||(y=Y.length,Y=Y.filter(function(q){var A;q=((A=q.actionProto)==null?void 0:A.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!RoS.includes(q)}),a=Y.length<y,!r.L.isActive()&&a&&r.L.start(1));
Y.length>0&&zo5(r,Y);return g.K(W,tbS(r),0)})},NET=function(r){var D,Y,V,L,T,I,B;
return g.E(function(m){if(m.W==1)return g.K(m,Str(r),2);D=m.T;Y=[];V=g.F(D);for(L=V.next();!L.done;L=V.next())T=L.value,I=g.yI(T.key),B=I.entityId,p3r(r.W,B)||Y.push(T);return g.K(m,dmM(r,Y),0)})},Eox=function(r){r=r*1E3-Date.now();
return r>4E3?4E3:r},lHM=function(r,D){var Y,V,L;
return g.E(function(T){Y=g.F(D);for(V=Y.next();!V.done;V=Y.next()){L=V.value;var I=void 0,B=void 0,m=((B=L.action)==null?void 0:(I=B.actionMetadata)==null?void 0:I.retryScheduleIntervalsInSeconds)||[1,2,4];I=1;L.retryScheduleIndex<m.length&&(I=m[L.retryScheduleIndex]);L.W=I*1E3+Date.now();L.retryScheduleIndex++}return g.K(T,voW(r,D),0)})},hoa=function(r){var D;
return g.E(function(Y){if(Y.W==1)return g.K(Y,fI(r.T,"offlineOrchestrationActionWrapperEntity"),2);D=Y.T;return g.K(Y,dmM(r,D),0)})},zo5=function(r,D){D.length!==0&&D.forEach(function(Y){Y=Uo(Y);
Y.retryScheduleIndex<3&&A7q(r.W,[Y])})},Str=function(r,D){var Y;
return g.E(function(V){if(V.W==1)return g.K(V,fI(r.T,"offlineOrchestrationActionWrapperEntity",D),2);Y=V.T;return V.return(Y.filter(O6q))})},voW=function(r,D){if(D.length===0)return Promise.resolve([]);
D=D.map(function(Y){return F$(Y)});
return U9S(r.T,D)},b7x=function(r){this.nP=r;
this.W=void 0},eo0=function(r,D){var Y,V,L,T;
return g.E(function(I){Y=D.videoId;V=!0;if(D.captionTracks.length)L=I3T(D),r.W=new g.g5(r.nP,D,L);else if(D.dJ)T=g.FHE(D),r.W=new g.Aw(r.nP,D.dJ,Y,T,D.gm,D.eventId),V=D.gm;else return I.return();return I.return(new Promise(function(B){var m;(m=r.W)==null||m.Az({Vb:function(){return g.E(function(G){if(G.W==1)return g.K(G,r.Vb(Y,V),2);B();g.uf(G)})},
Q7:function(){}})}))})},c7T=function(r){var D;
return g.E(function(Y){if(Y.W==1)return g.K(Y,J1S(r),2);D=Y.T;return Y.return(!!D&&D.length>0)})},NR=function(r){g.N.call(this);
this.W=r;this.T=this.W.observe(this.L.bind(this))},CJe=function(r,D){var Y,V,L,T,I,B,m;
return g.E(function(G){switch(G.W){case 1:if(D.length===0)return G.return([]);Y=D.map(function(M){return g.ah(M,"transfer")});
return g.K(G,fI(r.W,"transfer",Y),2);case 2:V=G.T;L=V.filter(O6q).map(function(M){return g.yI(M.key).entityId});
T=D.filter(function(M){return L.indexOf(M)===-1});
if(T.length===0)return G.return([]);I=g.F(T);B=I.next();case 3:if(B.done){G.wT(5);break}m=B.value;return g.K(G,BEa(m),4);case 4:B=I.next();G.wT(3);break;case 5:return G.return(T)}})},ooq=function(r,D,Y,V,L,T){var I,B,m;
return g.E(function(G){I="STREAM_TYPE_UNKNOWN";Y.video&&Y.audio?(I="STREAM_TYPE_AUDIO_AND_VIDEO",Vq("unexpected stream type")):Y.video&&!Y.audio?I="STREAM_TYPE_VIDEO":!Y.video&&Y.audio&&(I="STREAM_TYPE_AUDIO");B=g.ah(D,"offlineVideoStreams");m={numBytesDownloaded:L.toFixed(),numTotalBytes:T.toFixed(),streamType:I,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(V),itag:I==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Y.itag):void 0};return g.K(G,Pw(r,{mode:"readwrite",Hk:!0},
function(M){var Q=bj(M,B,"offlineVideoStreams"),y=bj(M,g.ah(D,"transfer"),"transfer");return g.lw.all([Q,y]).then(function(a){a=g.F(a);var W=a.next().value;a=a.next().value;if(!a)return Zu(M,B).then(function(){});
var q=Z75(W);W=X3S(W,V,m,B);var A=CI(M,W,"offlineVideoStreams");Z75(W)>q&&(a.lastProgressTimeMs=Date.now().toString());q=[A];a.offlineVideoStreams||(a.offlineVideoStreams=[]);a.offlineVideoStreams.indexOf(B)===-1&&(a.offlineVideoStreams.push(B),q.push(CI(M,a,"transfer")));return g.lw.all(q)})}),0)})},PJr=function(r,D){var Y,V,L,T,I;
return g.E(function(B){if(B.W==1)return Y=g.ah(D,"offlineVideoStreams"),g.K(B,Hw(r,Y,"offlineVideoStreams"),2);V=B.T;if(!V||!V.streamsProgress)return B.return();L=g.F(V.streamsProgress);for(T=L.next();!T.done;T=L.next())I=T.value,I.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",I.numTotalBytes!==I.numBytesDownloaded&&(I.numBytesDownloaded=I.numTotalBytes);return g.K(B,nI(r,V,"offlineVideoStreams"),0)})},X3S=function(r,D,Y,V){if(r&&r.streamsProgress){V=r;
a:{D=D.itag+";"+D.xtags;for(var L=r.streamsProgress,T=0;T<L.length;T++){var I=JSON.parse(L[T].formatStreamBytes);if(I.itag+";"+I.xtags===D){L[T]=Y;Y=L;break a}}L.push(Y);Y=L}V.streamsProgress=Y}else r={key:V,streamsProgress:[Y]};return r},Z75=function(r){if(r==null?0:r.streamsProgress){var D=0;
r=r.streamsProgress;for(var Y=0;Y<r.length;Y++){var V=r[Y];isNaN(Number(V.numBytesDownloaded))?Vq("stream progress bytes number invalid"):D+=Number(V.numBytesDownloaded)}return D}return 0},noT=function(r,D,Y,V){g.N.call(this);
var L=this;this.T=r;this.api=D;this.u$=Y;this.LP=V;this.D=new g.LF;this.S=new g.LN(function(){L.W&&L.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&L.D.GD()&&((L.W.transferRetryCount||0)<3?ds(L.N,L.j,!1,!1):ze(L.N,L.j.videoDetails.videoId),L.z3("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Tv=this.Gv=0;this.Y=this.K=!1;this.b$=g.qh(this.api.Z().experiments,"html5_transfer_processing_logs_interval");this.y_=new g.Cc(this);this.LC={jnT:function(){return L.S},
W4D:function(){return L.LP},
lR:function(){return L.D}};
this.i$=this.T.observe(this.Ix.bind(this));this.N=new xmc(D,this);this.UI=new b7x(D);this.gT=new NR(this.T);this.eD=this.D.listen("publicytnetworkstatus-online",this.Ga.bind(this));this.rT=this.D.listen("publicytnetworkstatus-offline",this.Q$z.bind(this));this.Y=this.api.Z().V("html5_less_transfer_processing_logs");g.v(this,this.y_);this.y_.X(D,"offlinetransferpause",this.k8F);g.YA(this.api.Z())?this.L="mainVideoDownloadStateEntity":g.Xg(this.api.Z())&&(this.L="musicTrackDownloadMetadataEntity")},
H7W=function(r){return g.E(function(D){if(D.W==1)D=g.K(D,tUM(),2);
else{var Y=r.gT;var V=g.Ea();V=Object.keys(V);Y=CJe(Y,V);D=g.K(D,Y,0)}return D})},bV=function(r,D){D=D===void 0?!1:D;
var Y;return g.E(function(V){if(V.W==1){if(r.W)throw Error("Already downloading a video");r.Tv=0;r.K=!1;return g.K(V,fHa(r),2)}return V.W!=4?(Y=V.T,DDS(r.u$,!Y),Y&&r.D.GD()?D?g.K(V,new Promise(function(L){g.$L(L,1E3)}),4):V.wT(4):(!Y&&r.W&&vp(r),V.wT(0))):g.K(V,w3x(r,Y),0)})},r2q=function(r){return g.E(function(D){if(D.W==1)return r.j?g.K(D,ze(r.N,r.j.videoDetails.videoId),3):D.wT(0);
vp(r);g.uf(D)})},D1r=function(r,D){var Y,V,L;
return g.E(function(T){switch(T.W){case 1:return g.q6(T,2),(Y=!!D.captionTracks.length||!!D.dJ)?g.K(T,c7T(D.videoId),4):T.return();case 4:return(V=T.T)?T.return():g.K(T,eo0(r.UI,D),5);case 5:g.gQ(T,0);break;case 2:L=g.$w(T),Vq("Caption downloading error",L,D.cotn),g.uf(T)}})},w3x=function(r,D){var Y,V,L,T,I,B;
return g.E(function(m){switch(m.W){case 1:if(r.K)return m.return();r.K=!0;r.W=D;Y=g.yI(r.W.key);V=Y.entityId;L=void 0;if(r.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.K(m,ef(r,V),7);if(r.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||r.W.transferRetryCount||r.W.hasLoggedFirstStarted){m.wT(3);break}return g.K(m,ef(r,V),5);case 5:return L=m.T,r.W.hasLoggedFirstStarted=!0,g.K(m,Y3R(r),6);case 6:YVS({videoId:V,cR:r.W,offlineModeType:L},void 0,void 0,!0);m.wT(3);break;case 7:L=m.T,
Bp({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:V,cR:r.W,offlineModeType:L});case 3:return g.K(m,V9e(r),8);case 8:return T=null,g.q6(m,9),g.K(m,Lu0(r,D),11);case 11:T=m.T;r.j=T;g.gQ(m,10);break;case 9:return I=g.$w(m),Vq("error getting player response",I,D.cotn),g.K(m,r.z3("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return m.return();case 10:return B=Bfc(r.api.Z(),D.cotn,T),g.K(m,D1r(r,B),13);case 13:return g.K(m,mm5(B.videoId),
14);case 14:B.kd=m.T,Qqr(r.N,B,D.maximumDownloadQuality),r.S.start(108E5),g.uf(m)}})},fHa=function(r){var D,Y;
return g.E(function(V){if(V.W==1)return g.K(V,fI(r.T,"transfer"),2);D=V.T;Y=D.filter(TZW).sort(IYe);return Y.length===0?V.return():V.return(Y[0])})},V9e=function(r){var D,Y,V;
return g.E(function(L){if(L.W==1){if(!r.W)return cp(r,"onTransferStart"),L.return();r.S.start(108E5);return g.K(L,C2(r,"TRANSFER_STATE_TRANSFERRING"),2)}D=r.W;return(V=((Y=D)==null?0:Y.key)?g.yI(D.key).entityId:"")&&r.L?g.K(L,Qq(V,r.L,r.T,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):L.wT(0)})},Mb5=function(r){var D,Y,V,L;
g.E(function(T){switch(T.W){case 1:if(!r.W){cp(r,"onTransferPausedByUser");T.wT(2);break}D=r.W;r.S.stop();return g.K(T,C2(r,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:V=((Y=D)==null?0:Y.key)?g.yI(D.key).entityId:"";if(!V||!r.L){T.wT(4);break}return g.K(T,Qq(V,r.L,r.T,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.K(T,ef(r,V),6);case 6:L=T.T,VVM({videoId:V,cR:D,offlineModeType:L});case 2:vp(r),bV(r),g.uf(T)}})},jqS=function(r){var D,Y,V;
g.E(function(L){if(L.W==1){if(!r.W)return cp(r,"onTransferPausedByNetwork"),L.return();r.S.stop();return g.K(L,C2(r,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(L.W!=3)return D=r.W,(V=((Y=D)==null?0:Y.key)?g.yI(D.key).entityId:"")&&r.L?g.K(L,Qq(V,r.L,r.T,"DOWNLOAD_STATE_PAUSED"),3):L.wT(3);vp(r);g.uf(L)})},x15=function(r){var D,Y,V,L,T;
g.E(function(I){switch(I.W){case 1:if(!r.W)return cp(r,"onTransferComplete"),I.return();D=r.W;r.S.stop();if(!D||!r.j){I.wT(2);break}Y=Bfc(r.api.Z(),D.cotn,r.j);return g.K(I,D1r(r,Y),2);case 2:return g.K(I,C2(r,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:L=((V=D)==null?0:V.key)?g.yI(D.key).entityId:"";if(!L||!r.L){I.wT(5);break}return g.K(I,Qq(L,r.L,r.T,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.K(I,PJr(r.T,L),7);case 7:return g.K(I,ef(r,L),8);case 8:T=I.T,Bp({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:L,cR:D,offlineModeType:T}),vp(r),bV(r),g.uf(I)}})},BZM=function(r,D,Y){var V,L;
g.E(function(T){switch(T.W){case 1:if(!r.W)return cp(r,"onTransferProgress: "+D),T.return();if(r.W.transferState==="TRANSFER_STATE_TRANSFERRING"){T.wT(2);break}return g.K(T,V9e(r),2);case 2:V=Date.now();if(!(V-r.Gv>1E3)){T.wT(4);break}r.Gv=V;return g.K(T,ooq(r.T,Y.videoId,Y.T,Y.SN,Y.bytesDownloaded,Y.W),5);case 5:if(r.Y&&!(r.Y&&V-r.Tv>r.b$)){T.wT(4);break}r.Tv=V;return g.K(T,ef(r,D),7);case 7:L=T.T,YVS({videoId:D,cR:r.W,offlineModeType:L},Y.bytesDownloaded,Y.W);case 4:r.S.start(108E5),g.uf(T)}})},
m15=function(r){var D=(r.W.transferRetryCount||0)<3;
D&&(r=r.W,r.transferRetryCount=(r.transferRetryCount||0)+1);return D},GHr=function(r,D){D=D===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":D;
var Y,V,L,T;return g.E(function(I){if(I.W==1)return r.W||cp(r,"setTransferToFailed: "+D),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D==="TRANSFER_FAILURE_REASON_NETWORK"?Y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":D==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.K(I,C2(r,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",D),2);if(I.W!=3)return Te(r.LP,{entityKey:(V=r.W)==null?void 0:V.key,failureReason:Y}),
L=r.W?g.yI(r.W.key).entityId:"",g.K(I,ef(r,L),3);T=I.T;var B={videoId:L,cR:r.W,offlineModeType:T},m=D,G={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};m&&(G.transferFailureReason=m,G.failureReason=LXT(m));Bp(G,B);g.uf(I)})},C2=function(r,D,Y,V){var L;
return g.E(function(T){if(T.W==1){if(!r.W)return cp(r,"saveTransferState: "+D),T.return();r.W.transferState=D;r.W.failureReason=V;g.q6(T,2);return g.K(T,Y3R(r,function(I){return Y?eY(I,"offlineVideoStreams",r.W.offlineVideoStreams).then(function(B){for(var m=g.F(B),G=m.next();!G.done;G=m.next())if((G=G.value)&&G.streamsProgress){G=g.F(G.streamsProgress);for(var M=G.next();!M.done;M=G.next())M.value.streamState=Y}return m9q(I,B.filter(function(Q){return!!Q}),"offlineVideoStreams")}):g.lw.resolve(void 0)}),
4)}if(T.W!=2)return g.gQ(T,0);
L=g.$w(T);return L instanceof g.OZ&&L.type==="QUOTA_EXCEEDED"?g.K(T,r.z3("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):T.wT(0)})},Y3R=function(r,D){var Y;
return g.E(function(V){if(!r.W)return V.return();Y=r.W;return g.K(V,Pw(r.T,{mode:"readwrite",Hk:!0},function(L){var T=[CI(L,Y,"transfer")];D&&T.push(D(L));return g.lw.all(T)}),0)})},vp=function(r){r.W=void 0;
r.j=void 0;r.S.stop()},Lu0=function(r,D){var Y,V,L,T,I;
return g.E(function(B){if(B.W==1)return Y=g.yI(D.key),V=Y.entityId,L=g.ah(V,"playbackData"),g.K(B,Hw(r.T,L,"playbackData"),2);T=B.T;if((I=T)==null?0:I.playerResponseJson)return B.return(JSON.parse(T.playerResponseJson));throw Error("No PlayerResponse found");})},cp=function(r,D){r.api.Wo("woffle",{mcte:D});
Vq("missing current transfer entity.")},ef=function(r,D){var Y,V,L;
return g.E(function(T){if(T.W==1)return g.K(T,Hw(r.T,g.ah(D,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Y=T.T;return T.return((L=(V=Y)==null?void 0:V.offlineModeType)!=null?L:void 0)})},TZW=function(r){return M9a[r.transferState]!==void 0},IYe=function(r,D){var Y=M9a[r.transferState],V=M9a[D.transferState];
return Y!==V?Y-V:Number(r.enqueuedTimestampMs)-Number(D.enqueuedTimestampMs)},Zp=function(r,D){var Y=this;
this.ag=r;this.api=D;this.D=new g.LF;this.j=new g.gt;this.LC={xF:function(){return Y.L.LC.xF()},
lR:function(){return Y.D},
cnz:function(){return Y.L},
Oe:function(){return Y.Oe()},
iK:function(){return Y.iK()},
wh:function(){return Y.wh()},
yq:function(){return Y.yq()},
jf:function(){return Y.jf()},
aE:function(V){return Y.aE(V)}};
this.L=new H6r(function(){return jxS(Y)},function(){Y.wh()},this.api.DO(),this.api.V.bind(this.api));
this.W=new L2(this.api);f_q(this.L)},jxS=function(r){return g.E(function(D){r.api.KP("onOrchestrationBecameLeader");
return g.K(D,r.iK(),0)})},sxT=function(r){var D,Y;
return g.E(function(V){if(V.W==1)return g.K(V,wa(),2);if(V.W!=3){D=V.T;if(!D)return Vq("PES is undefined"),V.return();r.T=new noT(D,r.api,r.L,r.W);Y=r.A_(D);return g.K(V,i7R(D,Y,r.L,r.W,r.ag),3)}r.N=V.T;return g.K(V,Qxr(r),0)})},Qxr=function(r){var D;
return g.E(function(Y){switch(Y.W){case 1:if(!r.T)return Vq("transferManager is undefined"),Y.return();if(r.T.W){Y.wT(2);break}return g.K(Y,bV(r.T),2);case 2:if(!r.ag.V("woffle_enable_main_downloads_library")){Y.wT(4);break}return g.K(Y,r.oa(),4);case 4:if(!r.ag.V("html5_offline_playback_position_sync")){Y.wT(6);break}return g.K(Y,r.Ha(),7);case 7:return g.K(Y,r.aE(864E5),6);case 6:return g.K(Y,r.refreshAllStaleEntities(43200,!0),9);case 9:return g.K(Y,r.lh(),10);case 10:if(!r.ag.V("html5_retry_downloads_for_expiration")){Y.wT(11);
break}return g.K(Y,r.jf(),11);case 11:return r.K=g.Ai(function(){r.refreshAllStaleEntities(43200,!0);r.lh()},9E5),g.Be(g.Gf(),function(){return r.yq()}),g.K(Y,wa(),13);
case 13:return D=Y.T,g.K(Y,nOr(D),14);case 14:wEr(r.L),g.uf(Y)}})},y2a=function(){var r,D,Y,V,L,T;
return g.E(function(I){switch(I.W){case 1:return g.K(I,wa(),2);case 2:r=I.T;if(!r)return I.return([]);D=Date.now()/1E3;return g.K(I,fI(r,"offlineVideoPolicy"),3);case 3:Y=I.T,V=g.F(Y),L=V.next();case 4:if(L.done){I.wT(6);break}T=L.value;if(!(T.expirationTimestamp&&Number(T.expirationTimestamp)<D)){I.wT(5);break}T.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";T.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.K(I,nI(r,T,"offlineVideoPolicy"),5);
case 5:L=V.next();I.wT(4);break;case 6:return I.return(Y.map(function(B){return B.key}))}})},X$=function(r,D,Y,V,L){var T,I,B;
return g.E(function(m){if(m.W==1)return g.K(m,wa(),2);T=m.T;if(!T)return m.return([]);I=D.map(function(G){var M=g.ah(G,Y);M={actionType:V,entityKey:M,actionMetadata:Object.assign({},mDM(),L)};V!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(M.actionMetadata.priority=0);G=new Wp(Y,G,M);return F$(G)});
B=U9S(T,I);f_q(r.L);return m.return(B)})},aYq=function(r,D,Y,V){var L,T,I,B,m,G,M,Q;
return g.E(function(y){switch(y.W){case 1:L=[],T=g.F(D),I=T.next();case 2:if(I.done){y.wT(4);break}B=I.value;if(B.upToDate||Y&&!B.shouldAutoSyncMetadata||!B.playlistId){y.wT(3);break}m={};switch(V){case "mainPlaylistEntity":G={nextAutoRefreshIntervalSeconds:B.checkInSeconds,autoSync:Y};m={mainPlaylistEntityActionMetadata:G};break;case "musicPlaylist":M={autoSync:Y},m={musicPlaylistEntityActionMetadata:M}}return g.K(y,X$(r,[B.playlistId],V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",m),6);case 6:(Q=
y.T)&&L.push.apply(L,g.k(Q));case 3:I=T.next();y.wT(2);break;case 4:return y.return(L)}})},WuS=function(r,D){var Y;
return g.E(function(V){return D.length?(Y=mDM(),g.n0(Y,Eo,{isEnqueuedForExpiredStreamUrlRefetch:!0}),r.api.Wo("qrd",{v:D.length}),V.return(X$(r,D,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y))):V.return([])})},U1x=function(r,D,Y){this.W=r;
this.ag=D;this.L=Y},q3S=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t;
return g.E(function(l){switch(l.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,T=[],g.q6(l,2),g.K(l,Fur(r,L),4);case 4:T=l.T;if(!(r.ag.V("woffle_enable_main_downloads_library")&&((I=T)==null?0:I.length))){l.wT(5);break}return g.K(l,ki_(r.W,[D.entityKey]),5);case 5:g.gQ(l,3);break;case 2:return B=g.$w(l),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.OZ&&B.type==="QUOTA_EXCEEDED"?(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Vq("Playlist add error"),l.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,m,G));case 3:M=[];if(!r.ag.V("html5_offline_prevent_redownload_downloaded_video")){l.wT(7);break}return g.K(l,xDS(r.W,"mainVideoEntity",T),8);case 8:T=l.T;case 7:if((Q=T)==null?0:Q.length)for(y=g.F(T),a=y.next();!a.done;a=y.next())if(W=a.value,q=W.offlineVideoData,A=void 0,(A=q)==null?0:A.videoId)p=void 0,t=Number(((p=D.actionMetadata)==null?void 0:p.priority)||
0)+1,M.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q.videoId,"mainVideoEntity",t,oD,uwr(D,q,L)));return l.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,M))}})},gy0=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS,O,h,J,R,S,Dx,TY,Io,z,M6,WW,mz,Ky,yW,Nx,sq,Zx,vR,Gg,lv,XD,QN,Xd,bS,oG,kt,sP,Eu,sH,Rk,Sj,Ny,iZ,w6,P7,LZ,p7,c6;
return g.E(function(yU){switch(yU.W){case 1:return Y=mY(D),V=D.entityKey,L=g.yI(V).entityId,T=[],I=!1,L==="!*$_ALL_ENTITIES_!*$"?(I=!0,g.K(yU,fI(r.W,"mainPlaylistEntity"),5)):g.K(yU,Hw(r.W,V,"mainPlaylistEntity"),4);case 4:(B=yU.T)&&T.push(B);yU.wT(3);break;case 5:T=yU.T;case 3:if((m=T)==null||!m.length)return yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));G=g.e(D.actionMetadata,kHT);Q=(M=G)==null?void 0:M.nextAutoRefreshIntervalSeconds;a=(y=G)==null?void 0:y.autoSync;W=[];A=q=
!0;p=!1;if(!I&&a===!1){yU.wT(6);break}g.q6(yU,7);return g.K(yU,zQS(0,!!a,!0,T),9);case 9:W=yU.T;g.gQ(yU,8);break;case 7:t=g.$w(yU);if(!(t instanceof Error&&t.message==="No data")){t instanceof Error&&t.message==="Empty response body"&&Vq(t.message);yU.wT(8);break}return L==="!*$_ALL_ENTITIES_!*$"?g.K(yU,a15(r.W,D,r.L,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.K(yU,sX_(L,r.W,D,r.L),8);case 8:if(!W.length||!I&&W[0].playlistId!==L)return yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));case 6:if(I){l=[];d=g.F(W);for(b=d.next();!b.done;b=d.next())n=b.value,n.upToDate||a&&!n.shouldAutoSyncMetadata||!n.playlistId||(P={nextAutoRefreshIntervalSeconds:n.checkInSeconds,autoSync:a},l.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n.playlistId,"mainPlaylistEntity",0,oD,{mainPlaylistEntityActionMetadata:P})));return yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,l))}W.length&&(Ly=W[0],p=!!Ly.upToDate,a&&(q=(xw=Ly.shouldAutoSyncMetadata)!=null?xw:!0,A=(rQ=Ly.shouldAutoSyncVideos)!=
null?rQ:!0,Ly.checkInSeconds&&(Q=Ly.checkInSeconds)));if(p||!q)return yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));c=[];w=T[0];if(!w.downloadState){u=void 0;yU.wT(15);break}return g.K(yU,Hw(r.W,w.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:u=yU.T;case 15:return C=u,kc=((bf=C)==null?0:bf.addedTimestampMillis)?String(C.addedTimestampMillis):void 0,g.q6(yU,17),g.K(yU,Fur(r,L,kc,Q),19);case 19:c=yU.T;g.gQ(yU,18);break;case 17:s_=g.$w(yU);if(!(s_ instanceof Error&&
s_.message==="No data for playlist")){if(s_ instanceof Error&&s_.message==="Empty response body for playlist")Vq(s_.message);else return py="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",fy="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",s_ instanceof g.OZ&&s_.type==="QUOTA_EXCEEDED"&&(py="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",fy="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,py,fy));yU.wT(18);
break}return g.K(yU,sX_(L,r.W,D,r.L),18);case 18:if(!A)return yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));IR=[];WS=new Map;if((O=c)==null?0:O.length)for(h=g.F(c),J=h.next();!J.done;J=h.next())R=J.value,S=R.offlineVideoData,Dx=void 0,((Dx=S)==null?0:Dx.videoId)&&WS.set(S.videoId,S);TY=new Map;Io=[];if((z=w)==null?0:(M6=z.videos)==null?0:M6.length)for(WW=g.F(w.videos),mz=WW.next();!mz.done;mz=WW.next())if(Ky=mz.value,yW=JSON.parse(g.yI(Ky).entityId),Nx=yW.videoId)WS.has(Nx)?(TY.set(Nx,
WS.get(Nx)),WS.delete(Nx)):Io.push(Nx);Zx=Number(((sq=D.actionMetadata)==null?void 0:sq.priority)||0)+1;vR=g.F(WS.entries());for(Gg=vR.next();!Gg.done;Gg=vR.next())lv=Gg.value,XD=g.F(lv),QN=XD.next().value,Xd=XD.next().value,bS=QN,oG=Xd,IR.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",bS,"mainVideoEntity",Zx,oD,uwr(D,oG,L)));kt=g.F(TY.entries());for(sP=kt.next();!sP.done;sP=kt.next())Eu=sP.value,sH=g.F(Eu),Rk=sH.next().value,Sj=sH.next().value,Ny=Rk,iZ=Sj,IR.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ny,"mainVideoEntity",Zx,oD,uwr(D,iZ,L)));w6=g.F(Io);for(P7=w6.next();!P7.done;P7=w6.next())LZ=P7.value,p7={playlistId:L},c6={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:p7},IR.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",LZ,"mainVideoEntity",0,oD,c6));return yU.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,IR))}})},$1R=function(r,D){var Y,V,L,T;
return g.E(function(I){switch(I.W){case 1:return Y=mY(D),g.q6(I,2),V=g.yI(D.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.K(I,a15(r.W,D,r.L,(L=D.actionMetadata)==null?void 0:(T=L.offlineLoggingData)==null?void 0:T.offlineDeleteReason),5):g.K(I,sX_(V,r.W,D,r.L),6);case 6:if(!r.ag.V("woffle_enable_main_downloads_library")){I.wT(5);break}return g.K(I,gdr(r.W,D.entityKey),5);case 5:g.gQ(I,3);break;case 2:return g.$w(I),I.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},Fur=function(r,D,Y,V){var L,T,I,B,m,G,M;
return g.E(function(Q){switch(Q.W){case 1:return g.K(Q,Ede([D]),2);case 2:return L=Q.T,g.K(Q,A2T(r,L[0],Y,V),3);case 3:return T=Q.T,I=T.mainPlaylistEntity,B=T.fKF,G=jXR(I,(m=B)==null?void 0:m.avatar),g.q6(Q,4),g.K(Q,qR(G),6);case 6:g.gQ(Q,5);break;case 4:M=g.$w(Q),M instanceof Error&&M.message==="Failed to fetch"&&Vq(M.message);case 5:return Q.return(L[0].videos)}})},A2T=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d;
return g.E(function(b){switch(b.W){case 1:L=Date.now().toString();Y||(Y=L);T=D.videos;I=D.playlistId;B=[];m=[];if(T)for(G=g.F(T),M=G.next();!M.done;M=G.next()){Q=M.value;y=Q.offlineVideoData;if(!y||!y.videoId)throw Vq("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");a=y.videoId;W={videoId:a,playlistId:I};q={id:g.ah(JSON.stringify(W),"mainPlaylistVideoEntity"),video:g.ah(a,"mainVideoEntity")};B.push(q);m.push(q.id)}p={key:g.ah(I,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Y,lastSyncedTimestampMillis:L};t={key:g.ah(I,"mainPlaylistEntity"),playlistId:I,videos:m,title:D.title,thumbnailStyleData:ON5(D),visibility:pfR(D),downloadState:p.key};D.channel&&(l=D.channel.offlineChannelData,A=hca(g.ah(I,"ytMainChannelEntity"),l),t.channelOwner=A.id);((d=t)==null?0:d.entityMetadata)?(t.entityMetadata.offlineLastModifiedTimestampSeconds=D.lastModifiedTimestamp,V&&(t.entityMetadata.nextAutoRefreshIntervalSeconds=String(V))):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:V?
String(V):void 0,offlineLastModifiedTimestampSeconds:D.lastModifiedTimestamp});g.q6(b,2);return g.K(b,Pw(r.W,{mode:"readwrite",Hk:!0},function(n){var P=CI(n,t,"mainPlaylistEntity"),Ly=CI(n,p,"mainPlaylistDownloadStateEntity");P=[P,Ly];Ly=g.F(B);for(var xw=Ly.next();!xw.done;xw=Ly.next())P.push(CI(n,xw.value,"mainPlaylistVideoEntity"));A&&P.push(CI(n,A,"ytMainChannelEntity"));return g.lw.all(P)}),4);
case 4:g.gQ(b,3);break;case 2:throw g.$w(b),Vq("PES failure for playlist"),Error("PES failure for playlist");case 3:return b.return({mainPlaylistEntity:t,fKF:A,zsQ:B})}})},hca=function(r,D){return{id:r,
channelId:D.channelId,title:D.title,avatar:D.thumbnail}},ON5=function(r){var D=[],Y=r.videos;
Y&&Y.length>0&&D.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Y[0].offlineVideoData.thumbnail}}});if((r=r.additionalMetadadatas)&&r.length>0)for(r=g.F(r),Y=r.next();!Y.done;Y=r.next()){var V=Y.value.offlineBundleItemPlaylistData,L=void 0;Y=(L=V)==null?void 0:L.style;L=void 0;V={collageThumbnail:{coverThumbnail:(L=V)==null?void 0:L.coverThumbnail}};switch(Y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":D.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:V});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":D.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":D.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":D.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:V})}}return D},pfR=function(r){switch(r.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},uwr=function(r,D,Y){D={offlineVideoData:D,
playlistId:Y};if(r=g.e(r.actionMetadata,kHT))D.maximumDownloadQuality=r.maximumDownloadQuality;return{mainVideoEntityActionMetadata:D}},t9M=function(r,D,Y){this.W=r;
this.ag=D;this.L=Y},KuW=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W;
return g.E(function(q){switch(q.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,T=g.e(D.actionMetadata,Pp),B=!((I=T)==null?0:I.playlistId),g.q6(q,2),g.K(q,iNq(r,L,void 0,(m=T)==null?void 0:m.offlineVideoData,B),4);case 4:g.gQ(q,3);break;case 2:return G=g.$w(q),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.OZ&&G.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
q.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,M,Q));case 3:y=1;y=Number(((a=D.actionMetadata)==null?void 0:a.priority)||0)+1;var A=(A=g.e(D.actionMetadata,Pp))?{playbackDataActionMetadata:{maximumDownloadQuality:A.maximumDownloadQuality}}:void 0;W=K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L,"playbackData",y,J2_,A);return q.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,[W]))}})},lYM=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t;
return g.E(function(l){switch(l.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,g.K(l,Hw(r.W,D.entityKey,"mainVideoEntity"),2);case 2:T=l.T;if(!T){I=void 0;l.wT(3);break}return g.K(l,Hw(r.W,T.downloadState,"mainVideoDownloadStateEntity"),4);case 4:I=l.T;case 3:B=I;if(!T||!B)return l.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.q6(l,5);return g.K(l,iNq(r,L,B.addedTimestampMillis,(G=g.e(D.actionMetadata,Pp))==null?void 0:G.offlineVideoData),7);case 7:M=1;M=Number(((Q=
D.actionMetadata)==null?void 0:Q.priority)||0)+1;m=K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L,"playbackData",M,J2_);g.gQ(l,6);break;case 5:y=g.$w(l);if(!(y instanceof Error&&y.message==="No data")){if(y instanceof Error&&y.message==="Empty response body")Vq(y.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.OZ&&y.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,a,W));l.wT(6);break}return g.K(l,$E(r.W,L),9);case 9:q=l.T;A=g.e(D.actionMetadata,Pp);if(t=(p=A)==null?void 0:p.playlistId)q.playlistId=t;q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.K(l,kE(L,r.W,D,r.L,q),6);case 6:return l.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,m?[m]:void 0))}})},Eyc=function(r,D){var Y,V,L,T,I,B,m,G,M,Q;
return g.E(function(y){switch(y.W){case 1:return Y=mY(D),g.q6(y,2),V=g.yI(D.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.K(y,a15(r.W,D,r.L,(M=D.actionMetadata)==null?void 0:(Q=M.offlineLoggingData)==null?void 0:Q.offlineDeleteReason),5):g.K(y,$E(r.W,V),6);case 6:L=y.T;T=g.e(D.actionMetadata,Pp);if(B=(I=T)==null?void 0:I.playlistId)L.playlistId=B;L.offlineDeleteReason=(m=D.actionMetadata)==null?void 0:(G=m.offlineLoggingData)==null?void 0:G.offlineDeleteReason;return g.K(y,kE(V,r.W,D,r.L,L),7);
case 7:if(!r.ag.V("woffle_enable_main_downloads_library")){y.wT(5);break}return g.K(y,gdr(r.W,D.entityKey),5);case 5:g.gQ(y,3);break;case 2:return g.$w(y),y.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return y.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},iNq=function(r,D,Y,V,L){var T,I,B,m,G,M;
return g.E(function(Q){switch(Q.W){case 1:if(T=V){Q.wT(2);break}return g.K(Q,l1c([D]),3);case 3:I=Q.T,T=I[0];case 2:return g.K(Q,Rce(r,T,Y,L),4);case 4:B=Q.T;m=B.mainVideoEntity;G=B.channelEntity;g.q6(Q,5);var y=aD(m.thumbnail),a=aD(G.avatar);return g.K(Q,qR(y.concat(a)),7);case 7:g.gQ(Q,0);break;case 5:M=g.$w(Q),M instanceof Error&&M.message==="Failed to fetch"&&Vq(M.message),g.uf(Q)}})},Rce=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y,a,W,q,A;
return g.E(function(p){switch(p.W){case 1:Y||(Y=Date.now().toString());T=(L=D.channel)==null?void 0:L.offlineChannelData;I={id:g.ah(D.videoId,"ytMainChannelEntity"),channelId:T.channelId,title:T.title,avatar:T.thumbnail};B={key:g.ah(D.videoId,"mainVideoDownloadStateEntity"),playbackData:g.ah(D.videoId,"playbackData"),addedTimestampMillis:Y,videoDownloadContextEntity:g.ah(D.videoId,"videoDownloadContextEntity")};m={key:g.ah(D.videoId,"videoPlaybackPositionEntity"),videoId:D.videoId,lastPlaybackPositionSeconds:"0"};
r.ag.V("html5_offline_playback_position_sync")&&(G={playbackPosition:m.key});M=g.ah(D.videoId,"mainVideoEntity");Q={key:M,videoId:D.videoId,title:D.title,thumbnail:D.thumbnail,localizedStrings:{viewCount:D.shortViewCountText},userState:G,lengthSeconds:D.lengthSeconds?Number(D.lengthSeconds):void 0,publishedTimestampMillis:D.publishedTimestamp?(Number(D.publishedTimestamp)*1E3).toString():void 0,formattedDescription:D.description,owner:I.id,downloadState:B.key};if(!r.ag.V("woffle_enable_main_downloads_library")||
!V){p.wT(2);break}return g.K(p,qVS(r.W,[M]),3);case 3:if(W=p.T)y=W.mainDownloadsLibraryEntity,a=W.mainDownloadsListEntity;case 2:return A=I1e,q={key:g.ah(D.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.n0(B,A,q),g.K(p,Pw(r.W,{mode:"readwrite",Hk:!0},function(t){var l=CI(t,I,"ytMainChannelEntity"),d=CI(t,B,"mainVideoDownloadStateEntity"),b=CI(t,Q,"mainVideoEntity");l=[l,d,b];r.ag.V("html5_offline_playback_position_sync")&&(d=CI(t,m,"videoPlaybackPositionEntity"),
l.push(d));y&&(d=CI(t,y,"mainDownloadsLibraryEntity"),l.push(d));a&&(d=CI(t,a,"mainDownloadsListEntity"),l.push(d));q&&(t=CI(t,q,"downloadStatusEntity"),l.push(t));return g.lw.all(l)}),4);
case 4:return p.return({mainVideoEntity:Q,channelEntity:I})}})},zcr=function(r,D,Y){this.W=r;
this.ag=D;this.L=Y},S30=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w;
return g.E(function(u){switch(u.W){case 1:return Y=mY(D),V=[],g.K(u,SY.getInstance(),2);case 2:L=u.T;if(!L){u.wT(3);break}return g.K(u,L.get("sdois"),4);case 4:return T=u.T,g.K(u,(B=L)==null?void 0:B.get("lmqf"),5);case 5:I=u.T;case 3:g.q6(u,6);if(T===void 0)throw Error("prefStorage or opt-in state is undefined");m=[];if(T){u.wT(8);break}return g.K(u,ujq(r.W),9);case 9:m=u.T,m.reverse();case 8:if(!m.length){u.wT(10);break}G=g.F(m);M=G.next();case 11:if(M.done){u.wT(10);break}Q=M.value;if(!Q){u.wT(12);
break}y=g.yI(Q).entityId;return g.K(u,$E(r.W,y),14);case 14:return a=u.T,a.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.K(u,kE(y,r.W,{entityKey:Q,actionType:D.actionType},r.L,a),12);case 12:M=G.next();u.wT(11);break;case 10:return g.K(u,SV0(T,(W=I)!=null?W:"SD"),16);case 16:return q=u.T,g.K(u,WXM(q),17);case 17:A=FXc(q);if(!r.ag.V("woffle_enable_main_downloads_library")){u.wT(18);break}if(T){u.wT(19);break}return g.K(u,gdr(r.W,g.E8),19);case 19:return g.K(u,ki_(r.W,[g.E8]),18);
case 18:if((p=A)==null?0:p.length)for(t=g.F(A),l=t.next();!l.done;l=t.next())if(b=d=l.value,n=b.actionType,P=b.entityKey,Ly=b.actionMetadata,n&&P&&Ly&&!g.e(Ly,d1c)){n==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Ly.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(xw=g.e(d.actionMetadata,Pp))xw.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",d.actionMetadata=Object.assign({},d.actionMetadata,{mainVideoEntityActionMetadata:xw});V.push(d)}g.gQ(u,7);break;
case 6:return rQ=g.$w(u),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",rQ instanceof g.OZ&&rQ.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,c,w));case 7:return u.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,V))}})},NZe=function(){Zp.apply(this,arguments);
this.Y="mainVideoEntity"},vyr=function(r,D,Y){D=D===void 0?43200:D;
Y=Y===void 0?!0:Y;var V=V===void 0?!1:V;var L,T,I;return g.E(function(B){switch(B.W){case 1:if(!r.D.GD())return B.return([]);L=[];g.q6(B,2);return g.K(B,zQS(D,Y,V),4);case 4:L=B.T;g.gQ(B,3);break;case 2:T=g.$w(B),T instanceof Error&&T.message==="No data"||T instanceof Error&&T.message==="Empty response body"&&Vq(T.message);case 3:return I=aYq(r,L,Y,"mainPlaylistEntity"),B.return(I)}})},bN5=function(r,D,Y,V){V=V===void 0?!1:V;
var L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t;return g.E(function(l){switch(l.W){case 1:return L=[],g.K(l,dDa(),2);case 2:return(T=l.T)||V?g.K(l,Nfe(D,Y),3):l.return([]);case 3:I=l.T;if((B=I)==null||!B.length)return l.return([]);m={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};G=g.F(I);M=G.next();case 4:if(M.done){l.wT(6);break}y=Q=M.value;a=y.actionType;W=y.entityKey;q=y.actionMetadata;if(!(a&&W&&q)||g.e(q,d1c)){l.wT(5);break}a==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(q.offlineLoggingData=
m);A=g.yI(W);p=A.entityId;return g.K(l,X$(r,[p],"mainVideoEntity",a,q),8);case 8:t=l.T,L=L.concat(t);case 5:M=G.next();l.wT(4);break;case 6:return l.return(L)}})},ecW=function(r,D){this.W=r;
this.L=D},C_0=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p;
return g.E(function(t){switch(t.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,T=[],g.q6(t,2),g.K(t,c25(r,L),4);case 4:T=t.T;if((I=T)==null||!I.length){t.wT(5);break}return g.K(t,hQq(r.W,D.entityKey),5);case 5:g.gQ(t,3);break;case 2:return B=g.$w(t),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.OZ&&B.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
t.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,m,G));case 3:return M=[],g.K(t,xDS(r.W,"musicTrack",T),7);case 7:T=t.T;if(T.length)for(Q=g.F(T),y=Q.next();!y.done;y=Q.next())if(a=y.value,W=a.offlineVideoData,q=void 0,(q=W)==null?0:q.videoId)A=void 0,p=Number(((A=D.actionMetadata)==null?void 0:A.priority)||0)+1,M.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",p,n2,hs(D,W,L)));return t.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,M))}})},
ZN5=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS,O,h,J,R,S,Dx,TY,Io,z,M6,WW,mz,Ky,yW,Nx,sq,Zx,vR,Gg,lv,XD,QN,Xd;
return g.E(function(bS){switch(bS.W){case 1:return Y=mY(D),V=D.entityKey,L=g.yI(V).entityId,T=[],I=!1,L==="!*$_ALL_ENTITIES_!*$"?(I=!0,g.K(bS,fI(r.W,"musicAlbumRelease"),5)):g.K(bS,Hw(r.W,V,"musicAlbumRelease"),4);case 4:(B=bS.T)&&T.push(B);bS.wT(3);break;case 5:T=bS.T;case 3:if((m=T)==null||!m.length)return bS.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));if(I){G=[];M=g.F(T);for(Q=M.next();!Q.done;Q=M.next())y=Q.value,a=g.yI(y.id).entityId,G.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
a,"musicAlbumRelease",0,n2));return bS.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,G))}W=[];q=T[0];A=void 0;if(!q.downloadMetadata){bS.wT(6);break}return g.K(bS,Hw(r.W,q.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:p=bS.T,A=Number((l=(t=p)==null?void 0:t.addedTimestampMillis)!=null?l:"0")/1E3;case 6:return g.q6(bS,8),g.K(bS,c25(r,L,(d=A)==null?void 0:d.toString()),10);case 10:W=bS.T;g.gQ(bS,9);break;case 8:b=g.$w(bS);if(!(b instanceof Error&&b.message===
"No data")){if(b instanceof Error&&b.message==="Empty response body")Vq(b.message);else return n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.OZ&&b.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),bS.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,n,P));bS.wT(9);break}return g.K(bS,Oo(L,"musicAlbumRelease",r.W,
D,r.L),9);case 9:Ly=[];xw=new Map;if((rQ=W)==null?0:rQ.length)for(c=g.F(W),w=c.next();!w.done;w=c.next())u=w.value,C=u.offlineVideoData,bf=void 0,((bf=C)==null?0:bf.videoId)&&xw.set(C.videoId,C);kc=new Map;s_=[];if((py=q)==null?0:(fy=py.tracks)==null?0:fy.length)for(IR=g.F(q.tracks),WS=IR.next();!WS.done;WS=IR.next())if(O=WS.value,h=g.yI(O).entityId)xw.has(h)?(kc.set(h,xw.get(h)),xw.delete(h)):s_.push(h);R=Number(((J=D.actionMetadata)==null?void 0:J.priority)||0)+1;S=g.F(xw.entries());for(Dx=S.next();!Dx.done;Dx=
S.next())TY=Dx.value,Io=g.F(TY),z=Io.next().value,M6=Io.next().value,WW=z,mz=M6,Ly.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",WW,"musicTrack",R,n2,hs(D,mz)));Ky=g.F(kc.entries());for(yW=Ky.next();!yW.done;yW=Ky.next())Nx=yW.value,sq=g.F(Nx),Zx=sq.next().value,vR=sq.next().value,Gg=Zx,lv=vR,Ly.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Gg,"musicTrack",R,n2,hs(D,lv)));XD=g.F(s_);for(QN=XD.next();!QN.done;QN=XD.next())Xd=QN.value,Ly.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Xd,
"musicTrack",0,n2));return bS.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,Ly))}})},XfS=function(r,D){var Y,V;
return g.E(function(L){switch(L.W){case 1:return Y=mY(D),g.q6(L,2),V=g.yI(D.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.K(L,p2(r.W,D,r.L),5):g.K(L,Oo(V,"musicAlbumRelease",r.W,D,r.L),6);case 6:return g.K(L,tVr(r.W,D.entityKey),5);case 5:g.gQ(L,3);break;case 2:return g.$w(L),L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},c25=function(r,D,Y){var V,L,T;
return g.E(function(I){switch(I.W){case 1:return g.K(I,Ede([D]),2);case 2:return V=I.T,g.K(I,oyM(r,V[0],Y),3);case 3:return L=I.T,T=aD(L.thumbnailDetails),g.K(I,qR(T),4);case 4:return I.return(V[0].videos)}})},oyM=function(r,D,Y){var V,L,T,I,B,m,G,M,Q,y,a,W,q,A;
return g.E(function(p){if(p.W==1){V=D.additionalMetadadatas;L=void 0;if(V&&V.length>0)for(T=g.F(V),I=T.next();!I.done;I=T.next())if(B=I.value,B.offlineMusicPlaylistData){L=B.offlineMusicPlaylistData;break}m=D.playlistId;G=iER(D);M=G.VE;Q=G.nD;y=Y?(Number(Y)*1E3).toString():Date.now().toString();a=D.lastModifiedTimestamp?(Number(D.lastModifiedTimestamp)*1E3).toString():"0";W={id:g.ah(m,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:Q,lastModifiedTimestampMillis:a,addedTimestampMillis:y,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};q={id:g.ah(m,"musicAlbumRelease"),title:D.title,audioPlaylistId:m,trackCount:D.totalVideoCount,tracks:M,downloadMetadata:W.id};L&&(q.thumbnailDetails=(A=L.albumHqThumbnail)!=null?A:L.albumArtistThumbnail,q.artistDisplayName=L.albumArtistDisplayName,q.releaseDate=L.albumReleaseDate,q.contentRating={explicitType:L.albumReleaseExplicitType},q.releaseType=L.albumReleaseType);return g.K(p,Pw(r.W,{mode:"readwrite",Hk:!0},function(t){var l=CI(t,q,"musicAlbumRelease");
t=CI(t,W,"musicAlbumReleaseDownloadMetadataEntity");return g.lw.all([l,t])}),2)}return p.return(q)})},P_e=function(r,D){this.W=r;
this.L=D},HNS=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p;
return g.E(function(t){switch(t.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,T=[],g.q6(t,2),g.K(t,ny_(r,L),4);case 4:T=t.T;if((I=T)==null||!I.length){t.wT(5);break}return g.K(t,hQq(r.W,D.entityKey),5);case 5:g.gQ(t,3);break;case 2:return B=g.$w(t),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.OZ&&B.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
t.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,m,G));case 3:return M=[],g.K(t,xDS(r.W,"musicTrack",T),7);case 7:T=t.T;if(T.length)for(Q=g.F(T),y=Q.next();!y.done;y=Q.next())if(a=y.value,W=a.offlineVideoData,q=void 0,(q=W)==null?0:q.videoId)A=void 0,p=Number(((A=D.actionMetadata)==null?void 0:A.priority)||0)+1,M.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",p,Hp,hs(D,W,L)));return t.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,M))}})},
fYM=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS,O,h,J,R,S,Dx,TY,Io,z,M6,WW,mz,Ky,yW,Nx,sq,Zx,vR,Gg,lv,XD,QN,Xd,bS,oG,kt,sP,Eu,sH,Rk,Sj,Ny,iZ,w6,P7;
return g.E(function(LZ){switch(LZ.W){case 1:return Y=mY(D),V=D.entityKey,L=g.yI(V).entityId,T=[],I=!1,L==="!*$_ALL_ENTITIES_!*$"?(I=!0,g.K(LZ,fI(r.W,"musicPlaylist"),5)):g.K(LZ,Hw(r.W,V,"musicPlaylist"),4);case 4:(B=LZ.T)&&T.push(B);LZ.wT(3);break;case 5:T=LZ.T;case 3:if((m=T)==null||!m.length)return LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));G=g.e(D.actionMetadata,Jyx);Q=(M=G)==null?void 0:M.autoSync;y=[];W=a=!0;q=!1;A=void 0;if(!I&&Q===!1){LZ.wT(6);break}g.q6(LZ,7);return g.K(LZ,
vda(0,!!Q,!0,T),9);case 9:y=LZ.T;g.gQ(LZ,8);break;case 7:p=g.$w(LZ);if(!(p instanceof Error&&p.message==="No data")){p instanceof Error&&p.message==="Empty response body"&&Vq(p.message);LZ.wT(8);break}return L==="!*$_ALL_ENTITIES_!*$"?g.K(LZ,p2(r.W,D,r.L),8):g.K(LZ,Oo(L,"musicPlaylist",r.W,D,r.L),8);case 8:if(!y.length||!I&&y[0].playlistId!==L)return LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));case 6:if(I){t=[];l=g.F(y);for(d=l.next();!d.done;d=l.next())b=d.value,b.upToDate||
Q&&!b.shouldAutoSyncMetadata||!b.playlistId||(n={autoSync:Q},t.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b.playlistId,"musicPlaylist",0,Hp,{musicPlaylistEntityActionMetadata:n})));return LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,t))}y.length&&(P=y[0],q=!!P.upToDate,Q&&(a=(Ly=P.shouldAutoSyncMetadata)!=null?Ly:!0,W=(xw=P.shouldAutoSyncVideos)!=null?xw:!0,P.checkInSeconds&&(A=P.checkInSeconds)));if(q||!a)return LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));rQ=[];c=T[0];w=void 0;if(!c.downloadMetadata){LZ.wT(15);break}return g.K(LZ,Hw(r.W,c.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:u=LZ.T,w=Number((bf=(C=u)==null?void 0:C.addedTimestampMillis)!=null?bf:"0")/1E3;case 15:return g.q6(LZ,17),g.K(LZ,ny_(r,L,(kc=w)==null?void 0:kc.toString(),A),19);case 19:rQ=LZ.T;g.gQ(LZ,18);break;case 17:s_=g.$w(LZ);if(!(s_ instanceof Error&&s_.message==="No data")){if(s_ instanceof Error&&s_.message==="Empty response body")Vq(s_.message);else return py=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",fy="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",s_ instanceof g.OZ&&s_.type==="QUOTA_EXCEEDED"&&(py="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",fy="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,py,fy));LZ.wT(18);break}return g.K(LZ,Oo(L,"musicPlaylist",r.W,D,r.L),18);case 18:if(!W)return LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));IR=[];WS=new Map;if((O=rQ)==null?0:O.length)for(h=g.F(rQ),J=h.next();!J.done;J=h.next())R=J.value,S=R.offlineVideoData,Dx=void 0,((Dx=S)==null?0:Dx.videoId)&&WS.set(S.videoId,S);TY=new Map;Io=[];if((z=c)==null?0:(M6=z.tracks)==null?0:M6.length)for(WW=g.F(c.tracks),mz=WW.next();!mz.done;mz=WW.next())if(Ky=mz.value,yW=g.yI(Ky).entityId)WS.has(yW)?(TY.set(yW,WS.get(yW)),WS.delete(yW)):Io.push(yW);sq=Number(((Nx=D.actionMetadata)==null?void 0:Nx.priority)||0)+1;Zx=g.F(WS.entries());for(vR=Zx.next();!vR.done;vR=
Zx.next())Gg=vR.value,lv=g.F(Gg),XD=lv.next().value,QN=lv.next().value,Xd=XD,bS=QN,IR.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Xd,"musicTrack",sq,Hp,hs(D,bS)));oG=g.F(TY.entries());for(kt=oG.next();!kt.done;kt=oG.next())sP=kt.value,Eu=g.F(sP),sH=Eu.next().value,Rk=Eu.next().value,Sj=sH,Ny=Rk,IR.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Sj,"musicTrack",sq,Hp,hs(D,Ny)));iZ=g.F(Io);for(w6=iZ.next();!w6.done;w6=iZ.next())P7=w6.value,IR.push(K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
P7,"musicTrack",0,Hp));return LZ.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,IR))}})},wfc=function(r,D){var Y,V;
return g.E(function(L){switch(L.W){case 1:return Y=mY(D),g.q6(L,2),V=g.yI(D.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.K(L,p2(r.W,D,r.L),5):g.K(L,Oo(V,"musicPlaylist",r.W,D,r.L),6);case 6:return g.K(L,tVr(r.W,D.entityKey),5);case 5:g.gQ(L,3);break;case 2:return g.$w(L),L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},ny_=function(r,D,Y,V){var L,T,I;
return g.E(function(B){switch(B.W){case 1:return g.K(B,Ede([D]),2);case 2:return L=B.T,g.K(B,rhr(r,L[0],Y,V),3);case 3:return T=B.T,I=aD(T.thumbnailDetails),g.K(B,qR(I),4);case 4:return B.return(L[0].videos)}})},rhr=function(r,D,Y,V){var L,T,I,B,m,G,M,Q,y;
return g.E(function(a){return a.W==1?(L=D.playlistId,T=iER(D),I=T.VE,B=T.nD,m=Y?(Number(Y)*1E3).toString():Date.now().toString(),G=D.lastModifiedTimestamp?(Number(D.lastModifiedTimestamp)*1E3).toString():"0",M={id:g.ah(L,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:B,lastModifiedTimestampMillis:G,addedTimestampMillis:m,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},Q={id:g.ah(L,"musicPlaylist"),title:D.title,playlistId:L,thumbnailDetails:D.thumbnail,visibility:DCM(D),trackCount:D.totalVideoCount,
tracks:I,downloadMetadata:M.id},V&&(((y=Q)==null?0:y.entityMetadata)?Q.entityMetadata.nextAutoRefreshIntervalSeconds=String(V):Q&&(Q.entityMetadata={nextAutoRefreshIntervalSeconds:String(V)})),g.K(a,Pw(r.W,{mode:"readwrite",Hk:!0},function(W){var q=CI(W,Q,"musicPlaylist");W=CI(W,M,"musicPlaylistDownloadMetadataEntity");return g.lw.all([q,W])}),2)):a.return(Q)})},DCM=function(r){switch(r.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},YNS=function(r,D){this.W=r;
this.L=D},ISc=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W;
return g.E(function(q){switch(q.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,T=g.e(D.actionMetadata,Vc0),g.q6(q,2),g.K(q,Lt_(r,L,void 0,(I=T)==null?void 0:I.track,(B=T)==null?void 0:B.albumRelease),4);case 4:if((m=T)==null?0:m.playlistId){q.wT(5);break}return g.K(q,hQq(r.W,D.entityKey),5);case 5:g.gQ(q,3);break;case 2:return G=g.$w(q),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.OZ&&G.type==="QUOTA_EXCEEDED"&&
(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,M,Q));case 3:a=Number(((y=D.actionMetadata)==null?void 0:y.priority)||0)+1;var A=(A=g.e(D.actionMetadata,Vc0))?{playbackDataActionMetadata:{maximumDownloadQuality:A.maximumDownloadQuality}}:void 0;W=K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L,"playbackData",a,T05,A);return q.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y,[W]))}})},xCq=function(r,D){var Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A;
return g.E(function(p){switch(p.W){case 1:return Y=mY(D),V=g.yI(D.entityKey),L=V.entityId,g.K(p,Hw(r.W,D.entityKey,"musicTrack"),2);case 2:T=p.T;if(!T){I=void 0;p.wT(3);break}return g.K(p,Hw(r.W,T.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:I=p.T;case 3:B=I;if(!T||!B)return p.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));G=g.e(D.actionMetadata,Vc0);g.q6(p,5);return g.K(p,Lt_(r,L,B.addedTimestampMillis,(M=G)==null?void 0:M.track,(Q=G)==null?void 0:Q.albumRelease),
7);case 7:a=Number(((y=D.actionMetadata)==null?void 0:y.priority)||0)+1;m=K2("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L,"playbackData",a,T05);g.gQ(p,6);break;case 5:W=g.$w(p);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof Error&&W.message==="Empty response body")Vq(W.message);else return q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.OZ&&W.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),p.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,q,A));p.wT(6);break}return g.K(p,As(L,r.W,D,r.L),6);case 6:return p.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,m?[m]:void 0))}})},B0W=function(r,D){var Y,V;
return g.E(function(L){switch(L.W){case 1:return Y=mY(D),g.q6(L,2),V=g.yI(D.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.K(L,p2(r.W,D,r.L),5):g.K(L,As(V,r.W,D,r.L),6);case 6:return g.K(L,tVr(r.W,D.entityKey),5);case 5:g.gQ(L,3);break;case 2:return g.$w(L),L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new lV("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},Lt_=function(r,D,Y,V,L){var T,I,B,m,G,M;
return g.E(function(Q){switch(Q.W){case 1:if(T=V){Q.wT(2);break}return g.K(Q,l1c([D]),3);case 3:I=Q.T,B=I[0],T=p8_(B);case 2:return g.K(Q,mCx(r,T,D,L,Y),4);case 4:m=Q.T;G=m.musicTrackEntity;M=m.ZD;var y=aD(G.thumbnailDetails),a=[];M&&(a=aD(M.thumbnailDetails));return g.K(Q,qR(y.concat(a)),0)}})},mCx=function(r,D,Y,V,L){var T;
return g.E(function(I){return I.W==1?(L||(L=Date.now().toString()),T={id:g.ah(Y,"musicTrackDownloadMetadataEntity"),playbackData:g.ah(Y,"playbackData"),addedTimestampMillis:L,videoDownloadContextEntity:g.ah(Y,"videoDownloadContextEntity")},V&&(D.albumRelease=V.id),g.K(I,Pw(r.W,{mode:"readwrite",Hk:!0},function(B){var m=[],G=CI(B,T,"musicTrackDownloadMetadataEntity");m.push(G);G=CI(B,D,"musicTrack");m.push(G);V&&(B=CI(B,V,"musicAlbumRelease"),m.push(B));return g.lw.all(m)}),2)):I.W!=3?g.K(I,Qq(Y,"musicTrackDownloadMetadataEntity",
r.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):I.return({musicTrackEntity:D,
ZD:V})})},f2=function(){Zp.apply(this,arguments);
this.Y="musicTrack"},Gw5=function(r,D,Y){D=D===void 0?43200:D;
Y=Y===void 0?!0:Y;var V=V===void 0?!1:V;var L,T;return g.E(function(I){switch(I.W){case 1:if(!r.D.GD())return I.return([]);L=[];g.q6(I,2);return g.K(I,vda(D,Y,V),4);case 4:L=I.T;g.gQ(I,3);break;case 2:g.$w(I);case 3:return T=aYq(r,L,Y,"musicPlaylist"),I.return(T)}})},McR=function(){g.uF.apply(this,arguments);
var r=this;this.events=new g.Cc(this);this.ag=this.player.Z();this.LC={Td_:function(){return r.W},
QA:function(){return r.QA()},
t4:function(D){return r.t4(D)}}},jQa=function(r){var D;
r=g.e((D=r.getWatchNextResponse())==null?void 0:D.currentVideoEndpoint,g.L9);if(r==null?0:r.playlistId)var Y=r.playlistId;return Y},QQe=function(r,D){var Y,V,L,T;
return g.E(function(I){if(I.W==1){Y=D.clientPlaybackNonce;V={cpn:Y,offlineSourceVisualElement:g.K0(D.Gv||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};D.T&&(V.videoFmt=Number(D.T.itag));D.S&&(V.audioFmt=Number(D.S.itag));if((L=jQa(D))&&D.videoId){var B=D.videoId;B=L!=="PPSV"?Promise.resolve(!1):r.W.wy(B);I=g.K(I,B,3)}else I=I.wT(2);return I}I.W!=2&&(T=I.T)&&(V.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");r.T=Y;g.FS("offlinePlaybackStarted",V);g.uf(I)})};
g.JI.prototype.cF=g.Vo(51,function(r){return this.app.cF(r)});
g.UF.prototype.cF=g.Vo(50,function(r){return g.b2a(this,9,r)});
g.U(zd,Ry);g.BW.Object.defineProperties(zd.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(r){this.W.entityMetadata=r}}});
g.U(B$q,zd);B$q.prototype.T=function(){return[]};
g.U(myr,zd);myr.prototype.T=function(){return[]};
g.U(GcR,zd);GcR.prototype.T=function(){return[]};
g.U(MjS,zd);MjS.prototype.T=function(){return[]};
g.U(jjq,zd);jjq.prototype.T=function(){var r=[];this.W.alternateChannel&&r.push(this.W.alternateChannel);this.W.alternateChannelList&&r.push.apply(r,g.k(this.W.alternateChannelList));this.W.oneofChannelEntity&&r.push(this.W.oneofChannelEntity);return[].concat(g.k(new Set(r)))};
g.U(QjS,zd);QjS.prototype.T=function(){var r=[];this.W.entryCollection&&r.push(this.W.entryCollection);return[].concat(g.k(new Set(r)))};
g.U(sjS,Ry);sjS.prototype.T=function(){var r=[];this.W.video&&r.push(this.W.video);return[].concat(g.k(new Set(r)))};
g.U(yWr,zd);yWr.prototype.T=function(){var r=[];this.W.parentPlaylist&&r.push(this.W.parentPlaylist);if(this.W.entries)for(var D=g.F(this.W.entries),Y=D.next();!Y.done;Y=D.next())r.push.apply(r,g.k((new sjS(Y.value)).T()));return[].concat(g.k(new Set(r)))};
g.U(a3_,zd);a3_.prototype.T=function(){var r=[];this.W.descriptionEntity&&r.push(this.W.descriptionEntity);this.W.creators&&r.push.apply(r,g.k(this.W.creators));this.W.theBiggestFan&&r.push(this.W.theBiggestFan);return[].concat(g.k(new Set(r)))};
g.U(WZr,zd);WZr.prototype.T=function(){return[]};
g.U(Uya,zd);Uya.prototype.T=function(){return[]};
g.U(FZ0,zd);FZ0.prototype.T=function(){return[]};
g.U(uKe,zd);uKe.prototype.T=function(){return[]};
g.U(qxM,zd);qxM.prototype.T=function(){return[]};
g.U(kcM,zd);kcM.prototype.T=function(){return[]};
g.U(gfS,zd);gfS.prototype.T=function(){return[]};
g.U($yS,zd);$yS.prototype.T=function(){return[]};
g.U(AWM,zd);AWM.prototype.T=function(){return[]};
g.U(Omc,zd);Omc.prototype.T=function(){var r=[];this.W.downloadsList&&r.push(this.W.downloadsList);this.W.smartDownloadsList&&r.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&r.push(this.W.recommendedDownloadsList);this.W.refresh&&r.push(this.W.refresh);return[].concat(g.k(new Set(r)))};
g.U(pFe,Ry);pFe.prototype.T=function(){var r=[];this.W.video&&r.push(this.W.video);this.W.playlist&&r.push(this.W.playlist);this.W.videoItem&&r.push(this.W.videoItem);this.W.playlistItem&&r.push(this.W.playlistItem);return[].concat(g.k(new Set(r)))};
g.U(hFW,zd);hFW.prototype.T=function(){var r=[];this.W.refresh&&r.push(this.W.refresh);if(this.W.downloads)for(var D=g.F(this.W.downloads),Y=D.next();!Y.done;Y=D.next())r.push.apply(r,g.k((new pFe(Y.value)).T()));return[].concat(g.k(new Set(r)))};
g.U(tj5,zd);tj5.prototype.T=function(){var r=[];this.W.localImageEntities&&r.push.apply(r,g.k(this.W.localImageEntities));return[].concat(g.k(new Set(r)))};
g.U(imT,zd);imT.prototype.T=function(){var r=[];this.W.playbackData&&r.push(this.W.playbackData);this.W.localImageEntities&&r.push.apply(r,g.k(this.W.localImageEntities));this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.k(new Set(r)))};
g.U(JWx,zd);JWx.prototype.T=function(){return[]};
g.U(KZ_,zd);KZ_.prototype.T=function(){var r=[];this.W.fakeChildren&&r.push.apply(r,g.k(this.W.fakeChildren));return[].concat(g.k(new Set(r)))};
g.U(l3c,zd);l3c.prototype.T=function(){var r=[];this.W.video&&r.push(this.W.video);this.W.playbackData&&r.push(this.W.playbackData);this.W.offlineVideoPolicy&&r.push(this.W.offlineVideoPolicy);return[].concat(g.k(new Set(r)))};
g.U(Ef_,zd);Ef_.prototype.T=function(){return[]};
g.U(RFr,zd);RFr.prototype.T=function(){var r=[];this.W.channelOwner&&r.push(this.W.channelOwner);this.W.videos&&r.push.apply(r,g.k(this.W.videos));this.W.collaboratorChannels&&r.push.apply(r,g.k(this.W.collaboratorChannels));this.W.downloadState&&r.push(this.W.downloadState);this.W.refresh&&r.push(this.W.refresh);return[].concat(g.k(new Set(r)))};
g.U(zFe,zd);zFe.prototype.T=function(){var r=[];this.W.video&&r.push(this.W.video);this.W.channelContributor&&r.push(this.W.channelContributor);return[].concat(g.k(new Set(r)))};
g.U(dyx,Ry);dyx.prototype.T=function(){var r=[];this.W.localImageEntities&&r.push.apply(r,g.k(this.W.localImageEntities));this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.k(new Set(r)))};
g.U(Sxx,Ry);Sxx.prototype.T=function(){var r=[];this.W.recommendedVideoMetadata&&r.push.apply(r,g.k((new dyx(this.W.recommendedVideoMetadata)).T()));return[].concat(g.k(new Set(r)))};
g.U(N$_,Ry);N$_.prototype.T=function(){var r=[];this.W.playbackPosition&&r.push(this.W.playbackPosition);return[].concat(g.k(new Set(r)))};
g.U(vfr,zd);vfr.prototype.T=function(){var r=[];this.W.owner&&r.push(this.W.owner);this.W.downloadState&&r.push(this.W.downloadState);this.W.userState&&r.push.apply(r,g.k((new N$_(this.W.userState)).T()));this.W.additionalMetadata&&r.push.apply(r,g.k((new Sxx(this.W.additionalMetadata)).T()));return[].concat(g.k(new Set(r)))};
g.U(bmM,zd);bmM.prototype.T=function(){var r=[];this.W.userChannelDetails&&r.push(this.W.userChannelDetails);return[].concat(g.k(new Set(r)))};
g.U(eF5,zd);eF5.prototype.T=function(){var r=[];this.W.channelOwner&&r.push(this.W.channelOwner);this.W.playbackPosition&&r.push(this.W.playbackPosition);this.W.localImageEntities&&r.push.apply(r,g.k(this.W.localImageEntities));this.W.downloadStatus&&r.push(this.W.downloadStatus);return[].concat(g.k(new Set(r)))};
g.U(cWW,zd);cWW.prototype.T=function(){return[]};
g.U(Cbr,zd);Cbr.prototype.T=function(){return[]};
g.U(ZmM,zd);ZmM.prototype.T=function(){return[]};
g.U(XFr,zd);XFr.prototype.T=function(){return[]};
g.U(ofS,zd);ofS.prototype.T=function(){return[]};
g.U(Pb5,zd);Pb5.prototype.T=function(){return[]};
g.U(nfq,zd);nfq.prototype.T=function(){return[]};
g.U(HmS,zd);HmS.prototype.T=function(){return[]};
g.U(f3_,zd);f3_.prototype.T=function(){return[]};
g.U(wFS,zd);wFS.prototype.T=function(){return[]};
g.U(rQ5,zd);rQ5.prototype.T=function(){return[]};
g.U(DQr,zd);DQr.prototype.T=function(){var r=[];this.W.trackDownloadMetadatas&&r.push.apply(r,g.k(this.W.trackDownloadMetadatas));return[].concat(g.k(new Set(r)))};
g.U(YGc,zd);
YGc.prototype.T=function(){var r=[];this.W.downloadedTracks&&r.push.apply(r,g.k(this.W.downloadedTracks));this.W.smartDownloadedTracks&&r.push.apply(r,g.k(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&r.push.apply(r,g.k(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&r.push.apply(r,g.k(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&r.push.apply(r,g.k(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&r.push.apply(r,g.k(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
r.push.apply(r,g.k(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&r.push.apply(r,g.k(this.W.metadataOnlyTracks));return[].concat(g.k(new Set(r)))};
g.U(VNS,zd);VNS.prototype.T=function(){var r=[];this.W.trackDownloadMetadatas&&r.push.apply(r,g.k(this.W.trackDownloadMetadatas));return[].concat(g.k(new Set(r)))};
g.U(LqR,zd);LqR.prototype.T=function(){var r=[];this.W.playbackData&&r.push(this.W.playbackData);this.W.localImageEntities&&r.push.apply(r,g.k(this.W.localImageEntities));this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.k(new Set(r)))};
g.U(T7a,zd);T7a.prototype.T=function(){var r=[];this.W.musicLibraryStatusEntity&&r.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&r.push.apply(r,g.k(this.W.primaryArtists));this.W.details&&r.push(this.W.details);this.W.userDetails&&r.push(this.W.userDetails);this.W.tracks&&r.push.apply(r,g.k(this.W.tracks));this.W.share&&r.push(this.W.share);this.W.downloadMetadata&&r.push(this.W.downloadMetadata);this.W.refresh&&r.push(this.W.refresh);return[].concat(g.k(new Set(r)))};
g.U(I4S,zd);I4S.prototype.T=function(){var r=[];this.W.albumRelease&&r.push(this.W.albumRelease);this.W.tracks&&r.push.apply(r,g.k(this.W.tracks));return[].concat(g.k(new Set(r)))};
g.U(xQ_,zd);xQ_.prototype.T=function(){var r=[];this.W.albumRelease&&r.push(this.W.albumRelease);return[].concat(g.k(new Set(r)))};
g.U(B7a,zd);B7a.prototype.T=function(){var r=[];this.W.details&&r.push(this.W.details);this.W.userDetails&&r.push(this.W.userDetails);return[].concat(g.k(new Set(r)))};
g.U(mQS,zd);mQS.prototype.T=function(){var r=[];this.W.parentArtist&&r.push(this.W.parentArtist);return[].concat(g.k(new Set(r)))};
g.U(GWa,zd);GWa.prototype.T=function(){var r=[];this.W.parentArtist&&r.push(this.W.parentArtist);return[].concat(g.k(new Set(r)))};
g.U(MNx,zd);MNx.prototype.T=function(){return[]};
g.U(jFr,zd);jFr.prototype.T=function(){return[]};
g.U(QF_,Ry);QF_.prototype.T=function(){var r=[];this.W.creatorEntity&&r.push(this.W.creatorEntity);return[].concat(g.k(new Set(r)))};
g.U(sFr,zd);
sFr.prototype.T=function(){var r=[];this.W.tracks&&r.push.apply(r,g.k(this.W.tracks));this.W.refresh&&r.push(this.W.refresh);this.W.musicLibraryStatusEntity&&r.push(this.W.musicLibraryStatusEntity);this.W.details&&r.push(this.W.details);this.W.downloadMetadata&&r.push(this.W.downloadMetadata);this.W.sideloadMetadata&&r.push(this.W.sideloadMetadata);this.W.userDetails&&r.push(this.W.userDetails);this.W.entryCollection&&r.push(this.W.entryCollection);this.W.share&&r.push(this.W.share);this.W.podcastShowAdditionalMetadata&&r.push.apply(r,
g.k((new QF_(this.W.podcastShowAdditionalMetadata)).T()));return[].concat(g.k(new Set(r)))};
g.U(yQ0,zd);yQ0.prototype.T=function(){return[]};
g.U(a4W,zd);
a4W.prototype.T=function(){var r=[];this.W.musicLibraryStatusEntity&&r.push(this.W.musicLibraryStatusEntity);this.W.artists&&r.push.apply(r,g.k(this.W.artists));this.W.audioModeVersion&&r.push(this.W.audioModeVersion);this.W.videoModeVersion&&r.push(this.W.videoModeVersion);this.W.userDetails&&r.push(this.W.userDetails);this.W.details&&r.push(this.W.details);this.W.albumRelease&&r.push(this.W.albumRelease);this.W.share&&r.push(this.W.share);this.W.libraryEdit&&r.push(this.W.libraryEdit);this.W.downloadMetadata&&
r.push(this.W.downloadMetadata);this.W.playbackPosition&&r.push(this.W.playbackPosition);this.W.lyrics&&r.push(this.W.lyrics);return[].concat(g.k(new Set(r)))};
g.U(Wqq,zd);Wqq.prototype.T=function(){var r=[];this.W.parentTrack&&r.push(this.W.parentTrack);return[].concat(g.k(new Set(r)))};
g.U(UQx,zd);UQx.prototype.T=function(){var r=[];this.W.parentTrack&&r.push(this.W.parentTrack);return[].concat(g.k(new Set(r)))};
g.U(Fqr,zd);Fqr.prototype.T=function(){return[]};
g.U(uVT,zd);uVT.prototype.T=function(){return[]};
g.U(qG5,zd);qG5.prototype.T=function(){return[]};
g.U(kW0,zd);kW0.prototype.T=function(){return[]};
g.U(gF0,zd);gF0.prototype.T=function(){var r=[];this.W.transfer&&r.push(this.W.transfer);this.W.adsPlaybackData&&r.push.apply(r,g.k(this.W.adsPlaybackData));this.W.drmLicense&&r.push(this.W.drmLicense);this.W.offlineVideoPolicy&&r.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&r.push(this.W.videoDownloadContextEntity);return[].concat(g.k(new Set(r)))};
g.U($Qq,zd);$Qq.prototype.T=function(){return[]};
g.U(AQe,zd);AQe.prototype.T=function(){var r=[];this.W.offlineVideoStreams&&r.push.apply(r,g.k(this.W.offlineVideoStreams));this.W.captionTrack&&r.push.apply(r,g.k(this.W.captionTrack));return[].concat(g.k(new Set(r)))};
g.U(OQR,zd);OQR.prototype.T=function(){return[]};
g.U(p4e,zd);p4e.prototype.T=function(){return[]};
g.U(h1q,zd);h1q.prototype.T=function(){return[]};
g.U(tNW,zd);tNW.prototype.T=function(){return[]};
g.U(iQc,zd);iQc.prototype.T=function(){return[]};
g.U(JQ0,zd);JQ0.prototype.T=function(){return[]};
g.U(KqT,zd);KqT.prototype.T=function(){return[]};
g.U(l4W,zd);l4W.prototype.T=function(){return[]};
g.U(EFa,zd);EFa.prototype.T=function(){return[]};
g.U(R1S,zd);R1S.prototype.T=function(){return[]};
g.U(z1r,zd);z1r.prototype.T=function(){return[]};
g.U(dQS,zd);dQS.prototype.T=function(){return[]};
g.U(SG0,zd);SG0.prototype.T=function(){return[]};
g.U(N7S,zd);N7S.prototype.T=function(){return[]};
g.U(vFr,zd);vFr.prototype.T=function(){return[]};
g.U(bQx,zd);bQx.prototype.T=function(){return[]};
g.U(e1R,zd);e1R.prototype.T=function(){return[]};
g.U(cQM,zd);cQM.prototype.T=function(){return[]};
g.U(C1S,zd);C1S.prototype.T=function(){return[]};
var bE0=["browse","music/browse","unplugged/browse"],X8c=["offline/playlist_sync_check"],KXS=["offline"],eQW=["offline/offline_video_playback_position_sync"],Coe=["offline/get_playback_data_entity"],da;SY.getInstance=function(){return g.E(function(r){return r.return(new Promise(function(D){g.Bh().then(function(Y){Y?(SY.instance||(SY.instance=new SY(Y)),D(SY.instance)):D(void 0)})}))})};
SY.prototype.get=function(r){var D=this,Y,V,L;return g.E(function(T){if(T.W==1)return g.K(T,P1q(D.token),2);if(T.W!=3)return Y=T.T,g.K(T,Y.get("prefs",r),3);V=T.T;if(!V)return T.return();L=(0,g.dU)();return V.expirationTimestampMs<=L?T.return():T.return(V.value)})};
SY.prototype.set=function(r,D,Y){Y=Y===void 0?31536E3:Y;var V=this,L,T,I;return g.E(function(B){if(B.W==1)return L=(0,g.dU)(),T={key:r,value:D,expirationTimestampMs:L+Y*1E3},g.K(B,P1q(V.token),2);I=B.T;return g.K(B,g.ce(I,"prefs",T),0)})};
SY.prototype.remove=function(r){var D=this,Y;return g.E(function(V){if(V.W==1)return g.K(V,P1q(D.token),2);Y=V.T;return g.K(V,Y.delete("prefs",r),0)})};
g.U(Nv,g.Vw);g.U(vw,r1T);vw.prototype.L=function(r,D){D=Yfe(D);r=(new TextEncoder).encode(JSON.stringify(r));return this.W.encrypt(r,D)};
vw.prototype.T=function(r,D){if(!(r instanceof Uint8Array))throw nFS(1);var Y=new TextDecoder;D=Yfe(D);r=this.W.decrypt(r,D);return JSON.parse(Y.decode(r))};
var VUS={accountLinkStatusEntity:FZ0,booleanEntity:GcR,buttonEntity:dQS,captionTrack:Fqr,channelHandle:B$q,commerceAcquisitionClientPayloadEntity:N7S,commerceCartListEntity:vFr,contextNoteFeedEntityPayload:myr,continuationTokenEntity:Ef_,downloadQualityPickerEntity:gfS,downloadsPageRefreshTokenEntity:AWM,downloadsPageViewConfigurationEntity:cWW,downloadStatusEntity:$yS,dismissState:JQ0,sfvAudioItemCurrentlyPlayingEntity:h1q,emojiFountainDataEntity:R1S,emojiCustomizationSetEntity:EFa,fakeChannel:jjq,
fakePlaylist:QjS,fakePlaylistEntryCollection:yWr,fakeVideo:a3_,fakeVideoDescription:WZr,featuredProductsEntity:f3_,flowStateEntity:Uya,iconBadgeEntity:bQx,interstitialInteractionStateEntity:qxM,likeButtonAnimationEntity:Cbr,liveChatPollStateEntity:kcM,liveViewerLeaderboardPointsEntity:p4e,liveReactionsDataEntity:z1r,logoEntity:uKe,macroMarkerEntity:ZmM,mainDownloadsLibraryEntity:Omc,mainDownloadsListEntity:hFW,mainPlaylistDownloadStateEntity:tj5,mainPlaylistEntity:RFr,mainPlaylistVideoEntity:zFe,
mainVideoDownloadStateEntity:imT,mainVideoEntity:vfr,markersEngagementPanelSyncEntity:XFr,markersVisibilityOverrideEntity:ofS,musicAlbumReleaseDetail:I4S,musicAlbumReleaseDownloadMetadataEntity:DQr,musicAlbumRelease:T7a,musicAlbumReleaseUserDetail:xQ_,musicArtistDetail:mQS,musicArtist:B7a,musicArtistUserDetail:GWa,musicDownloadsLibraryEntity:YGc,musicLibraryEdit:MNx,musicLibraryStatusEntity:jFr,musicPlaylist:sFr,musicPlaylistDownloadMetadataEntity:VNS,musicShare:yQ0,musicTrackDetail:Wqq,musicTrackDownloadMetadataEntity:LqR,
musicTrack:a4W,musicTrackUserDetail:UQx,offlineOrchestrationActionWrapperEntity:uVT,offlineVideoPolicy:qG5,offlineVideoStreams:kW0,offlineabilityEntity:JWx,orchestrationWebSamplingEntity:KZ_,pageHeaderEntity:KqT,pdpStateEntity:e1R,pinnedProductEntity:wFS,playbackData:gF0,playerStateEntity:Pb5,quantityIncrementerEntity:cQM,refresh:$Qq,saveToPlaylistListEntity:tNW,settingEntity:iQc,stringEntity:MjS,suggestedFeedbackChipStateEntity:nfq,transfer:AQe,trendingOfferEntity:rQ5,videoDownloadContextEntity:OQR,
videoOverviewAsyncDataEntity:C1S,videoPlaybackPositionEntity:SG0,votingEntity:l4W,ytMainChannelEntity:bmM,youchatPendingResponseEntity:HmS,ytMainDownloadedVideoEntity:l3c,ytMainVideoEntity:eF5};g.U(X0,r1T);X0.prototype.L=function(r){return r};
X0.prototype.T=function(r){if(r instanceof Uint8Array)throw nFS(0);return r};
g.U(oy,g.N);oy.prototype.observe=function(r){var D=this;this.observers.push(r);return function(){var Y=D.observers.indexOf(r);Y>=0&&D.observers.splice(Y,1)}};
oy.prototype.T=function(r){WWT(this,r.data)};
oy.prototype.F2=function(){this.channel.close()};
var k_e,UDc=new g.RQ("elementsCommand");var gs=new g.RQ("entityBatchUpdate");var I1e=new g.RQ("downloadStatusEntity");var kHT=new g.RQ("mainPlaylistEntityActionMetadata");var Pp=new g.RQ("mainVideoEntityActionMetadata");var Jyx=new g.RQ("musicPlaylistEntityActionMetadata");var Vc0=new g.RQ("musicTrackEntityActionMetadata");var d1c=new g.RQ("localImageEntityActionMetadata");var Eo=new g.RQ("playbackDataActionMetadata");var Fca=new g.RQ("transferEntityActionMetadata");var Lcr=new g.RQ("videoPlaybackPositionEntityActionMetadata");var d9r;new g.gt;new g.gt;eEx.prototype.request=function(r,D,Y){D=D===void 0?{}:D;return this.locks.request(r,D,function(V){return Y(V)})};var YE=g.vW.caches,Dp,oOq;rs.prototype.open=function(r){return YE.open(Z6W(r))};
rs.prototype.has=function(r){return YE.has(Z6W(r))};
rs.prototype.delete=function(r){return YE.delete(Z6W(r))};
rs.prototype.match=function(r,D){var Y=this,V,L,T,I,B,m;return g.E(function(G){switch(G.W){case 1:return g.K(G,Y.keys(),2);case 2:V=G.T,L=g.F(V),T=L.next();case 3:if(T.done){G.wT(5);break}I=T.value;return g.K(G,Y.open(I),6);case 6:return B=G.T,g.K(G,B.match(r,D),7);case 7:if(m=G.T)return G.return(m);T=L.next();G.wT(3);break;case 5:return G.return()}})};
g.U(CcM,rs);CcM.prototype.keys=function(){var r,D,Y,V,L,T,I,B,m;return g.E(function(G){if(G.W==1)return r=[],D=g.LL("CacheStorage keys"),g.K(G,YE.keys(),2);Y=G.T;V=g.F(Y);for(L=V.next();!L.done;L=V.next()){T=L.value;var M=T.indexOf(":");I=M===-1?{uP:T}:{uP:T.substring(0,M),datasyncId:T.substring(M+1)};B=I.uP;m=I.datasyncId;m===D&&r.push(B)}return G.return(r)})};g.U(L2,g.N);L2.prototype.L=function(r){this.api.KP("onOfflineOperationFailure",r.data)};
L2.prototype.S=function(r){this.api.publish("offlinetransferpause",r.data)};
L2.prototype.F2=function(){var r;(r=this.W)==null||r.close();var D;(D=this.T)==null||D.close()};H6r.prototype.EY=function(){this.W&&ID(this)};
H6r.prototype.PZ=function(){this.T&&this.T.resolve();this.L=this.W=!1;this.Y()};var RoS=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var yyq="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var OET="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.U(PoM,Js);PoM.prototype.T=function(r){return Ge(r)?f1S(this,r):MR(r)?DmR(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.U(YtT,Js);YtT.prototype.T=function(r){return MR(r)?VbM(this,r):TfR(r)?TEc(this,r):jf(r)?IHe(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.x=xmc.prototype;g.x.Nkb=function(r){var D=this,Y,V,L,T;return g.E(function(I){if(!g.X(r.state,128))return I.wT(0);Y=r.state.Qf;var B=(V=Y)==null?void 0:V.errorCode,m=(L=Y)==null?void 0:L.HF;T=B==="net.connect"&&m===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(B==null?0:B.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.K(I,D.z3(D.player.getVideoData().videoId,T),0)})};
g.x.z3=function(r,D){var Y=this;return g.E(function(V){if(V.W==1){if(Y.T)return V.return();Y.T=!0;return D==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(ds(Y,r,!1,!0),V.wT(0)):g.K(V,ze(Y,r),3)}g.zp(r,4);return g.K(V,Y.W.z3(D),0)})};
g.x.hx=function(r){r.status===2?(r.status!==this.L&&(V9e(this.W),g.zp(r.videoId,2)),r.kJ&&BZM(this.W,r.videoId,r.kJ)):r.status===4?(ze(this,r.videoId),this.z3(r.videoId,r.YH?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):r.status===1&&x15(this.W);this.L=r.status;this.api.KP("localmediachange",{videoId:r.videoId,status:r.status})};
g.x.Fn=function(){var r=this,D;return g.E(function(Y){if(Y.W==1){if(r.T)return Y.return();r.T=!0;D=r.player.getVideoData().videoId;return g.K(Y,ze(r,D),2)}return g.K(Y,r.W.Fn(),0)})};
g.x.yM=function(r){switch(r){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.x.V=function(r){return this.api.Z().V(r)};g.U(sq5,Js);sq5.prototype.T=function(r){return Ge(r)?aH5(this,r):MR(r)?WcT(this,r):TfR(r)?Umq(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};$m0.prototype.W=function(r,D){var Y=r.action.actionMetadata.priority-D.action.actionMetadata.priority;Y===0&&(r.W<D.W?Y=-1:r.W>D.W&&(Y=1));return Y};g.U(Sf,g.N);Sf.prototype.F2=function(){this.Y&&this.Y();g.N.prototype.F2.call(this)};
Sf.prototype.createAction=function(r,D){var Y=g.yI(r.entityKey).entityType,V=g.l6(16);return new Wp(Y,V,r,D.actionId,D.rootActionId)};
Sf.prototype.LP=function(r){var D=this,Y,V,L,T,I,B,m,G,M;return g.E(function(Q){if(Q.W==1){if(D.DQ())return Q.return();V=(Y=r.offlineOrchestrationActionWrapperEntity)!=null?Y:new Set;L=[];T=g.F(V);for(I=T.next();!I.done;I=T.next())B=I.value,m=g.yI(B),G=m.entityId,p3r(D.W,G)||L.push(B);return g.K(Q,Str(D,L),2)}M=Q.T;return g.K(Q,dmM(D,M),0)})};
Sf.prototype.retry=function(){var r=this;return g.E(function(D){return g.K(D,NET(r),0)})};b7x.prototype.Vb=function(r,D){D=D===void 0?!0:D;var Y=this,V,L,T,I,B,m,G,M;return g.E(function(Q){switch(Q.W){case 1:if(!Y.W)return Q.return();V=[];L=g.x5(Y.W.T,D);T=[];for(I={k0:0};I.k0<L.length;I={k0:I.k0},I.k0++)B=L[I.k0],m=Y.W.WC(B,"json3"),G=g.S1(m,{withCredentials:!0,format:"RAW"},3,500).then(function(y){return function(a){a={metadata:g.qr(L[y.k0]),trackData:a.xhr.responseText};T.push(a)}}(I)).k_(function(y){Vq("Caption fetch error",y)}),V.push(G);
return g.K(Q,xyR(V),2);case 2:return g.q6(Q,3),g.K(Q,i6M(r,T),5);case 5:g.gQ(Q,0);break;case 3:M=g.$w(Q),Vq("Caption DB transaction error",M),g.uf(Q)}})};g.U(NR,g.N);NR.prototype.F2=function(){this.T&&this.T();g.N.prototype.F2.call(this)};
NR.prototype.L=function(r){var D=this,Y,V,L,T,I,B,m,G;return g.E(function(M){V=(Y=r.transfer)!=null?Y:new Set;L=[];T=g.F(V);for(I=T.next();!I.done;I=T.next())B=I.value,m=g.yI(B),G=m.entityId,L.push(G);return L.length===0?M.return():g.K(M,CJe(D,L),0)})};g.U(noT,g.N);g.x=noT.prototype;g.x.F2=function(){this.i$&&this.i$();this.gT.dispose();this.S.dispose();this.eD&&g.Ci(this.D.D$,this.eD);this.rT&&g.Ci(this.D.D$,this.rT);g.N.prototype.F2.call(this)};
g.x.k8F=function(r){var D=this,Y,V,L;return g.E(function(T){switch(T.W){case 1:Y=g.ah(r,"transfer");if(D.W&&Y===D.W.key){ds(D.N,D.j,!0);D.S.stop();T.wT(0);break}return g.K(T,Pw(D.T,{mode:"readwrite",Hk:!0},function(I){return bj(I,Y,"transfer").then(function(B){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!=="TRANSFER_STATE_FAILED")return B.transferState="TRANSFER_STATE_PAUSED_BY_USER",CI(I,B,"transfer").then(function(){return B})})}),3);
case 3:V=T.T;if(!V){T.wT(0);break}if(!r||!D.L){T.wT(5);break}return g.K(T,Qq(r,D.L,D.T,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.K(T,ef(D,r),7);case 7:L=T.T,VVM({videoId:r,cR:V,offlineModeType:L}),g.uf(T)}})};
g.x.Q$z=function(){var r=this;if(this.W&&this.j){ds(this.N,this.j,!1);var D=this.W,Y=(D==null?0:D.key)?g.yI(D.key).entityId:"";Y&&this.L&&(new Promise(function(V,L){Qq(Y,r.L,r.T,"DOWNLOAD_STATE_PAUSED").catch(function(T){L(T)})})).catch(function(V){Vq("Download state setting error",V)})}this.S.stop()};
g.x.Ga=function(){this.W?w3x(this,this.W):bV(this)};
g.x.Ix=function(r){var D=this;return g.E(function(Y){switch(Y.W){case 1:if(!D.W){Y.wT(2);break}if(D.W.transferState==="TRANSFER_STATE_COMPLETE"||D.W.transferState==="TRANSFER_STATE_FAILED"||!r.transfer||!r.transfer.has(D.W.key)){Y.wT(3);break}return g.K(Y,Hw(D.T,D.W.key,"transfer"),4);case 4:D.W=Y.T;if(D.W){Y.wT(3);break}return g.K(Y,r2q(D),3);case 3:if(D.W)return Y.return();case 2:return g.K(Y,bV(D),0)}})};
g.x.z3=function(r,D){var Y=this,V,L,T,I,B;return g.E(function(m){switch(m.W){case 1:if(!Y.W){cp(Y,"onTransferFailure: "+r);m.wT(2);break}V=Y.W;T=((L=V)==null?0:L.key)?g.yI(V.key).entityId:"";a:switch(r){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var G=!1;break a;default:G=!0}return G&&m15(Y)?g.K(m,C2(Y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.K(m,
GHr(Y,r),5);case 5:if(!T||!Y.L){m.wT(2);break}return g.K(m,Qq(T,Y.L,Y.T,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.K(m,ef(Y,T),9);case 9:I=m.T;Bp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:T,cR:V,offlineModeType:I});if(!T||!Y.L){m.wT(2);break}return g.K(m,Qq(T,Y.L,Y.T,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:vp(Y),B=bV(Y,!0),D&&D(B),g.uf(m)}})};
g.x.Fn=function(r){var D=this,Y,V,L,T,I,B,m,G,M,Q,y,a;return g.E(function(W){switch(W.W){case 1:if(!D.W){cp(D,"onMaybeTransferStreamsExpired");W.wT(2);break}return m15(D)?g.K(W,C2(D,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.K(W,GHr(D,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!D.L){W.wT(2);break}Y=D.W;L=((V=Y)==null?0:V.key)?g.yI(Y.key).entityId:"";if(!L){W.wT(2);break}return g.K(W,Qq(L,D.L,D.T,"DOWNLOAD_STATE_FAILED"),2);case 9:return D.W||cp(D,"onMaybeTransferStreamsExpiredRetryAttempting"),
T=D.W,B=((I=T)==null?0:I.key)?g.yI(T.key).entityId:"",g.K(W,ef(D,B),10);case 10:return m=W.T,Bp({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:B,cR:T,offlineModeType:m}),G=mDM(),g.n0(G,Eo,{isEnqueuedForExpiredStreamUrlRefetch:!0}),M=g.ah(B,"playbackData"),Q={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:M,actionMetadata:G},y=F$(new Wp("playbackData",B,Q)),g.K(W,nI(D.T,y,"offlineOrchestrationActionWrapperEntity"),2);case 2:vp(D),a=bV(D,!0),
r&&r(a),g.uf(W)}})};
var sQr={},M9a=(sQr.TRANSFER_STATE_TRANSFERRING=1,sQr.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,sQr);g.x=Zp.prototype;g.x.Oe=function(){return this.j.promise};
g.x.iK=function(){if(this.T&&this.N)return this.j.promise;sxT(this).then(this.j.resolve).catch(this.j.reject);return this.j.promise};
g.x.A_=function(r){var D={};return D.playbackData=new PoM(r,this.ag,this.W),D.transfer=new sq5(r,this.ag),D.videoPlaybackPositionEntity=new YtT(r,this.ag),D};
g.x.yq=function(){var r=this;return g.E(function(D){return r.T?g.K(D,H7W(r.T),0):D.wT(0)})};
g.x.wh=function(){var r=this,D,Y;return g.E(function(V){if(V.W==1)return r.T||r.N?g.K(V,r.Oe(),2):V.return();r.K!==void 0&&(g.pM(r.K),r.K=void 0);r.S!==void 0&&(g.pM(r.S),r.S=void 0);(D=r.T)==null||D.dispose();r.T=void 0;(Y=r.N)==null||Y.dispose();r.N=void 0;r.api.KP("onOrchestrationLostLeader");r.j=new g.gt;g.uf(V)})};
g.x.isOrchestrationLeader=function(){return this.L.W};
g.x.wy=function(){return g.E(function(r){return r.return(!1)})};
g.x.Xn=function(r){var D=this.W;D.api.publish("offlinetransferpause",r);var Y;(Y=D.T)==null||Y.postMessage(r)};
g.x.Ga=function(r){var D,Y;return g.E(function(V){if(V.W==1)return g.K(V,wa(),2);D=V.T;if(!D)return V.return();Y=g.ah(r,"transfer");return g.K(V,Pw(D,{mode:"readwrite",Hk:!0},function(L){var T=bj(L,Y,"transfer"),I=bj(L,g.ah(r,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lw.all([T,I]).then(function(B){B=g.F(B);var m=B.next().value;var G=B.next().value;return m&&m.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(m.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",CI(L,m,"transfer").then(function(){Bp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:r,cR:m,offlineModeType:G==null?void 0:G.offlineModeType});return g.lw.resolve(null)})):g.lw.resolve(null)})}),0)})};
g.x.Sf=function(r){r=r===void 0?43200:r;var D=this,Y,V,L,T,I,B,m,G;return g.E(function(M){if(M.W==1)return D.D.GD()?g.K(M,wa(),2):M.return(y2a());if(M.W!=3){Y=M.T;if(!Y)return M.return([]);V=Date.now()/1E3;return g.K(M,fI(Y,"offlineVideoPolicy"),3)}L=M.T;T=[];I=g.F(L);for(B=I.next();!B.done;B=I.next())m=B.value,Number(m.lastUpdatedTimestampSeconds)+r<=V&&(G=g.yI(m.key).entityId,T.push(G));return T.length?M.return(X$(D,T,D.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):M.return([])})};
g.x.deleteAll=function(){return X$(this,["!*$_ALL_ENTITIES_!*$"],this.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.x.refreshAllStaleEntities=function(r){var D=this;return g.E(function(Y){return Y.W==1?g.K(Y,D.Sf(r),2):Y.return(Y.T)})};
g.x.setUpPositionSyncInterval=function(r){var D=this;this.S!==void 0&&(g.pM(this.S),this.S=void 0);var Y=r!=null?r:864E5;this.S=g.Ai(function(){D.aE(Y)},Y)};
g.x.aE=function(r){var D=this,Y,V,L,T,I,B;return g.E(function(m){switch(m.W){case 1:return g.q6(m,2),g.K(m,SY.getInstance(),4);case 4:Y=m.T;if(!Y)throw Error("prefStorage is undefined");return g.K(m,Y.get("psi"),5);case 5:V=m.T;T=((L=V)==null?0:L.Tn)?Number(V.Tn)/1E3:0;I=Date.now();if(!(T+r<=I)){m.wT(6);break}return g.K(m,X$(D,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.gQ(m,0);break;case 2:B=g.$w(m),Vq("Offline manager error",B),
g.uf(m)}})};
g.x.jf=function(){var r=this,D,Y,V,L,T,I,B;return g.E(function(m){if(m.W==1)return g.K(m,wa(),2);if(m.W!=3)return(D=m.T)?g.K(m,fI(D,"transfer"),3):m.return([]);Y=m.T;V=[];L=g.F(Y);for(T=L.next();!T.done;T=L.next())I=T.value,I.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&I.key&&(B=g.yI(I.key).entityId,V.push(B));return m.return(WuS(r,V))})};
g.x.lh=function(){return g.E(function(r){return r.return([])})};
g.x.oa=function(){return g.E(function(r){g.uf(r)})};
g.x.Ha=function(){return g.E(function(r){g.uf(r)})};g.U(U1x,Js);U1x.prototype.T=function(r){return Ge(r)?q3S(this,r):MR(r)?gy0(this,r):jf(r)?$1R(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var oD=[10];g.U(t9M,Js);t9M.prototype.T=function(r){return Ge(r)?KuW(this,r):MR(r)?lYM(this,r):jf(r)?Eyc(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var J2_=[10];g.U(zcr,Js);zcr.prototype.T=function(r){return MR(r)?S30(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.U(NZe,Zp);g.x=NZe.prototype;g.x.A_=function(r){var D=Zp.prototype.A_.call(this,r);D.mainVideoEntity=new t9M(r,this.ag,this.W);D.mainPlaylistEntity=new U1x(r,this.ag,this.W);D.mainDownloadsListEntity=new zcr(r,this.ag,this.W);return D};
g.x.refreshAllStaleEntities=function(r,D){var Y=this,V,L,T,I,B,m,G,M,Q,y,a;return g.E(function(W){switch(W.W){case 1:V=[];if(!Y.ag.V("web_player_offline_playlist_auto_refresh")){W.wT(2);break}return g.K(W,vyr(Y,r,D),3);case 3:V=W.T;case 2:return g.K(W,SY.getInstance(),4);case 4:return L=W.T,g.K(W,(T=L)==null?void 0:T.get("sdois"),5);case 5:return I=W.T,g.K(W,(B=L)==null?void 0:B.get("lmqf"),6);case 6:m=W.T;if(!I){W.wT(7);break}M=V;Q=M.concat;return g.K(W,bN5(Y,I,(G=m)!=null?G:"SD",r===0),8);case 8:V=
Q.call(M,W.T);case 7:return y=V,a=y.concat,g.K(W,Zp.prototype.refreshAllStaleEntities.call(Y,r,D),9);case 9:return V=a.call(y,W.T),W.return(V)}})};
g.x.wy=function(r){var D,Y,V,L,T,I,B,m;return g.E(function(G){if(G.W==1)return g.K(G,wa(),2);if(G.W!=3)return(D=G.T)?g.K(G,Hw(D,g.E8,"mainDownloadsListEntity"),3):G.return(!1);Y=G.T;if((V=Y)==null?0:(L=V.downloads)==null?0:L.length)for(T=g.ah(r,"mainVideoEntity"),I=g.F(Y.downloads),B=I.next();!B.done;B=I.next())if(m=B.value,m.videoItem===T)return G.return(!0);return G.return(!1)})};
g.x.lh=function(){var r=this,D,Y,V,L,T,I,B,m;return g.E(function(G){if(G.W==1)return g.K(G,wa(),2);if(G.W!=3)return(D=G.T)?g.K(G,fI(D,"downloadStatusEntity"),3):G.return([]);Y=G.T;V=[];L=g.F(Y);for(T=L.next();!T.done;T=L.next())I=T.value,I.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&I.key&&(B=g.yI(I.key).entityId,V.push(B));return V.length?(m={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},G.return(X$(r,V,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
m))):G.return([])})};
g.x.Ha=function(){var r;return g.E(function(D){return D.W==1?g.K(D,wa(),2):(r=D.T)?g.K(D,Pw(r,{mode:"readwrite",Hk:!0},function(Y){return eY(Y,"mainVideoEntity").then(function(V){var L=[];V=g.F(V);for(var T=V.next();!T.done;T=V.next()){T=T.value;var I=void 0;(I=T.userState)!=null&&I.playbackPosition||(I=g.yI(T.key).entityId,I={key:g.ah(I,"videoPlaybackPositionEntity"),videoId:I,lastPlaybackPositionSeconds:"0"},L.push(CI(Y,I,"videoPlaybackPositionEntity")),T.userState={playbackPosition:I.key},L.push(CI(Y,
T,"mainVideoEntity")))}return g.lw.all(L)})}),0):D.return()})};
g.x.oa=function(){var r,D,Y,V,L,T,I,B,m,G,M,Q,y,a,W,q,A,p,t,l,d,b,n,P,Ly,xw,rQ,c,w,u,C,bf,kc,s_,py,fy,IR,WS;return g.E(function(O){if(O.W==1)return g.K(O,wa(),2);if(O.W!=3){r=O.T;if(!r)return O.return();D=g.ah("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.K(O,Pw(r,{mode:"readonly",Hk:!0},function(h){return g.lw.all([bj(h,D,"mainDownloadsListEntity"),bj(h,g.E8,"mainDownloadsListEntity"),eY(h,"mainVideoEntity"),eY(h,"mainPlaylistEntity")])}),3)}Y=O.T;
V=g.F(Y);L=V.next().value;T=V.next().value;I=V.next().value;B=V.next().value;m=L;G=T;M=I;Q=B;y=new Set;if((a=m)==null?0:(W=a.downloads)==null?0:W.length)for(q=g.F(m.downloads),A=q.next();!A.done;A=q.next())p=A.value,t=void 0,(l=(t=p.videoItem)!=null?t:p.playlistItem)&&y.add(l);if((d=G)==null?0:(b=d.downloads)==null?0:b.length)for(n=g.F(G.downloads),P=n.next();!P.done;P=n.next())Ly=P.value,Ly.videoItem&&y.add(Ly.videoItem);xw=new Set;rQ=[];c=g.F(Q);for(w=c.next();!w.done;w=c.next()){u=w.value;if(u.videos)for(C=
g.F(u.videos),bf=C.next();!bf.done;bf=C.next())kc=bf.value,(s_=JSON.parse(g.yI(kc).entityId).videoId)&&xw.add(s_);u.key&&!y.has(u.key)&&rQ.push(u.key)}py=g.F(M);for(fy=py.next();!fy.done;fy=py.next())IR=fy.value,IR.key&&!y.has(IR.key)&&(WS=g.yI(IR.key).entityId,xw.has(WS)||rQ.push(IR.key));return rQ.length?g.K(O,ki_(r,rQ),0):O.wT(0)})};g.U(ecW,Js);ecW.prototype.T=function(r){return Ge(r)?C_0(this,r):MR(r)?ZN5(this,r):jf(r)?XfS(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var n2=[10];g.U(P_e,Js);P_e.prototype.T=function(r){return Ge(r)?HNS(this,r):MR(r)?fYM(this,r):jf(r)?wfc(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var Hp=[10];g.U(YNS,Js);YNS.prototype.T=function(r){return Ge(r)?ISc(this,r):MR(r)?xCq(this,r):jf(r)?B0W(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var T05=[10];g.U(f2,Zp);f2.prototype.A_=function(r){var D=Zp.prototype.A_.call(this,r);D.musicTrack=new YNS(r,this.W);D.musicPlaylist=new P_e(r,this.W);D.musicAlbumRelease=new ecW(r,this.W);return D};
f2.prototype.refreshAllStaleEntities=function(r,D){var Y=this,V,L,T;return g.E(function(I){if(I.W==1)return g.K(I,Gw5(Y,r,D),2);if(I.W!=3)return L=V=I.T,T=L.concat,g.K(I,Zp.prototype.refreshAllStaleEntities.call(Y,r,D),3);V=T.call(L,I.T);return I.return(V)})};g.U(McR,g.uF);g.x=McR.prototype;g.x.create=function(){var r=this;g.v(this,this.events);g.YA(this.ag)?this.W=new NZe(this.ag,this.player):g.Xg(this.ag)&&(this.W=new f2(this.ag,this.player));this.events.X(this.player,"onPlaybackStartExternal",function(){r.QA()});
this.events.X(this.player,"videodatachange",function(){r.QA()});
this.ag.V("html5_offline_playback_position_sync")&&this.events.X(this.player,"presentingplayerstatechange",this.t4)};
g.x.aW=function(){return!1};
g.x.F6=function(r,D,Y,V){var L=this;return g.E(function(T){return L.W?T.return(X$(L.W,r,D,Y,V)):T.return(Promise.reject())})};
g.x.deleteAll=function(){return this.W.deleteAll()};
g.x.Sf=function(r){return this.W.Sf(r)};
g.x.refreshAllStaleEntities=function(r){return this.W.refreshAllStaleEntities(r)};
g.x.setUpPositionSyncInterval=function(r){this.W.setUpPositionSyncInterval(r)};
g.x.Xn=function(r){this.W.Xn(r)};
g.x.Ga=function(r){return this.W.Ga(r)};
g.x.QA=function(){var r=this,D;return g.E(function(Y){D=r.player.getVideoData();return g.La(D)?jQa(D)&&r.T!==D.clientPlaybackNonce?g.K(Y,QQe(r,D),0):Y.wT(0):Y.return()})};
g.x.t4=function(r){var D=this,Y,V,L,T,I,B,m;return g.E(function(G){if(G.W==1)return Y=D.player.getVideoData(),V=Y.b$,g.$N(r,2)||g.$N(r,512)?g.K(G,wa(),2):G.return();if(G.W!=3){L=G.T;if(!L)return Vq("PES is undefined"),G.return();T=Y.videoId;return g.K(G,Hw(L,g.ah(T,"mainVideoEntity"),"mainVideoEntity"),3)}I=G.T;if(!I)return G.return();B=Math.floor(V).toString();m={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:B}};return g.K(G,D.F6([T],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
m),0)})};
g.x.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.x.updateDownloadState=function(r,D){var Y,V,L,T;return g.E(function(I){if(I.W==1)return g.K(I,wa(),2);Y=I.T;if(!Y)return Vq("PES is undefined"),I.return();V=g.yI(r);L=V.entityType;T=V.entityId;return g.K(I,Qq(T,L,Y,D,!0),0)})};g.Fx("offline",McR);})(_yt_player);
