{% extends 'admin/base.html' %}

{% block title %}Order #{{ order.order_number }} | RoZoom Admin{% endblock %}

{% block content %}
<div class="admin-card">
    <div class="admin-card-header">
        <h1>Order #{{ order.order_number }}</h1>
        <div class="d-flex gap-2">
            <a href="{{ url_for('admin.orders') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Orders
            </a>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-8">
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3>Order Items</h3>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.items %}
                            <tr>
                                <td>
                                    <strong>{{ item.product_name }}</strong>
                                    {% if item.product_slug %}
                                    <br><small class="text-muted">{{ item.product_slug }}</small>
                                    {% endif %}
                                </td>
                                <td>{{ item.quantity }}</td>
                                <td>€{{ "%.2f"|format(item.price_per_unit) }}</td>
                                <td>€{{ "%.2f"|format(item.total_price) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="3">Subtotal</th>
                                <th>€{{ "%.2f"|format(order.subtotal) }}</th>
                            </tr>
                            {% if order.discount %}
                            <tr>
                                <th colspan="3">Discount</th>
                                <th>-€{{ "%.2f"|format(order.discount) }}</th>
                            </tr>
                            {% endif %}
                            {% if order.tax %}
                            <tr>
                                <th colspan="3">Tax</th>
                                <th>€{{ "%.2f"|format(order.tax) }}</th>
                            </tr>
                            {% endif %}
                            <tr>
                                <th colspan="3">Total</th>
                                <th>€{{ "%.2f"|format(order.total) }}</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3>Order Details</h3>
                </div>
                <div class="admin-card-body">
                    <dl class="row">
                        <dt class="col-sm-5">Order Number:</dt>
                        <dd class="col-sm-7">{{ order.order_number }}</dd>

                        <dt class="col-sm-5">Status:</dt>
                        <dd class="col-sm-7">
                            <span class="badge
                                {% if order.order_status == 'pending' %}badge-warning
                                {% elif order.order_status == 'processing' %}badge-info
                                {% elif order.order_status == 'completed' %}badge-success
                                {% elif order.order_status == 'cancelled' %}badge-secondary
                                {% else %}badge-danger{% endif %}">
                                {{ order.order_status.title() }}
                            </span>
                        </dd>

                        <dt class="col-sm-5">Payment Status:</dt>
                        <dd class="col-sm-7">
                            <span class="badge
                                {% if order.payment_status == 'pending' %}badge-warning
                                {% elif order.payment_status == 'paid' %}badge-success
                                {% elif order.payment_status == 'failed' %}badge-danger
                                {% else %}badge-secondary{% endif %}">
                                {{ order.payment_status.title() }}
                            </span>
                        </dd>

                        <dt class="col-sm-5">Created:</dt>
                        <dd class="col-sm-7">{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>

                        {% if order.updated_at %}
                        <dt class="col-sm-5">Updated:</dt>
                        <dd class="col-sm-7">{{ order.updated_at.strftime('%Y-%m-%d %H:%M') }}</dd>
                        {% endif %}
                    </dl>
                </div>
            </div>

            <div class="admin-card mt-3">
                <div class="admin-card-header">
                    <h3>Customer Information</h3>
                </div>
                <div class="admin-card-body">
                    <dl class="row">
                        <dt class="col-sm-5">Name:</dt>
                        <dd class="col-sm-7">{{ order.first_name }} {{ order.last_name }}</dd>

                        <dt class="col-sm-5">Email:</dt>
                        <dd class="col-sm-7">{{ order.email }}</dd>

                        {% if order.phone %}
                        <dt class="col-sm-5">Phone:</dt>
                        <dd class="col-sm-7">{{ order.phone }}</dd>
                        {% endif %}

                        {% if order.address_line1 %}
                        <dt class="col-sm-5">Address:</dt>
                        <dd class="col-sm-7">
                            {{ order.address_line1 }}
                            {% if order.address_line2 %}<br>{{ order.address_line2 }}{% endif %}
                            <br>{{ order.city }}, {{ order.postal_code }}
                            {% if order.country %}<br>{{ order.country_name }}{% endif %}
                        </dd>
                        {% endif %}
                    </dl>
                </div>
            </div>

            {% if order.notes %}
            <div class="admin-card mt-3">
                <div class="admin-card-header">
                    <h3>Notes</h3>
                </div>
                <div class="admin-card-body">
                    {{ order.notes }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
